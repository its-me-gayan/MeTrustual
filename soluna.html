<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Soluna</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
body { background:#fef6f0; font-family:'Nunito',sans-serif; display:flex; justify-content:center; align-items:flex-start; min-height:100vh; padding:32px 16px 60px; }

/* ‚îÄ‚îÄ PHONE ‚îÄ‚îÄ */
.phone { width:360px; min-height:740px; background:#fff8f5; border-radius:44px; overflow:hidden; box-shadow:0 24px 60px rgba(200,100,100,0.15),0 4px 16px rgba(200,100,100,0.08); position:relative; border:1.5px solid rgba(255,200,190,0.5); }
.notch { background:#fff8f5; display:flex; justify-content:center; padding:10px 0 4px; }
.notch-inner { width:90px; height:22px; background:#f0e0da; border-radius:0 0 14px 14px; }
.status { display:flex; justify-content:space-between; padding:2px 22px 6px; font-size:0.65rem; font-weight:800; color:#c9a0a0; }

/* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
.screen { display:none; }
.screen.active { display:block; animation:pop 0.3s ease; }
@keyframes pop { from{opacity:0;transform:scale(0.98)} to{opacity:1;transform:scale(1)} }
.scr-pad { padding:0 22px 110px; }

/* ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ */
.nav { position:absolute; bottom:0; left:0; right:0; background:white; border-top:1.5px solid #fce8e4; display:flex; padding:10px 0 18px; border-radius:0 0 44px 44px; }
.nav-item { flex:1; display:flex; flex-direction:column; align-items:center; gap:3px; cursor:pointer; font-size:0.55rem; font-weight:800; color:#e0b0b0; text-transform:uppercase; letter-spacing:0.4px; }
.nav-item span { font-size:1.3rem; transition:transform 0.2s; }
.nav-item.on { color:#d97b8a; }
.nav-item.on span { transform:scale(1.15); }
.nav-item.on-bl { color:#4a70b0; }
.nav-item.on-bl span { transform:scale(1.15); }
.nav-item.on-gr { color:#5a8e6a; }
.nav-item.on-gr span { transform:scale(1.15); }

/* ‚îÄ‚îÄ SHARED COMPONENTS ‚îÄ‚îÄ */
.page-title { font-size:1.3rem; font-weight:900; color:#3d2828; margin-bottom:4px; }
.page-sub { font-size:0.72rem; font-weight:700; color:#d0a0a8; margin-bottom:16px; }
.section { font-size:0.72rem; font-weight:900; color:#c0a0a8; text-transform:uppercase; letter-spacing:0.6px; margin-bottom:10px; margin-top:20px; }
.section:first-of-type { margin-top:0; }
.save-btn { width:100%; padding:15px; background:linear-gradient(135deg,#f09090,#d97b8a); color:white; border:none; border-radius:18px; font-size:0.9rem; font-weight:800; cursor:pointer; font-family:'Nunito',sans-serif; box-shadow:0 6px 18px rgba(217,123,138,0.35); transition:all 0.2s; margin-top:18px; }
.save-btn:hover { transform:translateY(-2px); }
.save-btn-bl { background:linear-gradient(135deg,#7aa0e0,#4a70b0); box-shadow:0 6px 18px rgba(74,112,176,0.3); }
.save-btn-gr { background:linear-gradient(135deg,#78c890,#5a8e6a); box-shadow:0 6px 18px rgba(90,142,106,0.3); }

/* ‚îÄ‚îÄ SPLASH ‚îÄ‚îÄ */
.splash { position:absolute; inset:0; z-index:999; background:linear-gradient(165deg,#fff4f0 0%,#fde8f0 35%,#ede8fc 70%,#e8eeff 100%); display:flex; flex-direction:column; align-items:center; justify-content:center; border-radius:42px; overflow:hidden; }
.sp-rings { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; }
.sp-ring { position:absolute; border-radius:50%; border:1.5px solid rgba(217,123,138,0.15); animation:spRing 2.8s ease-out infinite; }
.sp-ring:nth-child(1){width:150px;height:150px;animation-delay:0s}
.sp-ring:nth-child(2){width:220px;height:220px;animation-delay:0.7s}
.sp-ring:nth-child(3){width:300px;height:300px;animation-delay:1.4s}
@keyframes spRing{0%{transform:scale(0.5);opacity:0.9}100%{transform:scale(1.5);opacity:0}}
.sp-petals { position:absolute; inset:0; overflow:hidden; pointer-events:none; }
.sp-p { position:absolute; bottom:-50px; animation:spFloat linear infinite; opacity:0; }
@keyframes spFloat{0%{transform:translateY(0) rotate(0);opacity:0}8%{opacity:0.7}85%{opacity:0.3}100%{transform:translateY(-110vh) rotate(400deg);opacity:0}}
.sp-logo { position:relative; z-index:2; width:100px; height:100px; border-radius:50%; background:linear-gradient(145deg,#fde8c8,#f0d8f4); display:flex; align-items:center; justify-content:center; box-shadow:0 0 0 10px rgba(253,232,200,0.4),0 12px 36px rgba(201,123,58,0.25); animation:breathe 2.5s ease-in-out infinite; margin-bottom:14px; }
.sp-logo span { font-size:2.8rem; animation:rock 2.5s ease-in-out infinite; }
@keyframes breathe{0%,100%{transform:scale(1)}50%{transform:scale(1.07)}}
@keyframes rock{0%,100%{transform:rotate(-5deg)}50%{transform:rotate(5deg)}}
.sp-name { font-size:1.8rem; font-weight:900; color:#3d2828; letter-spacing:-0.5px; opacity:0; animation:slideUp 0.7s cubic-bezier(.2,.8,.4,1) 0.3s forwards; }
.sp-name em { color:#c97b3a; font-style:normal; }
.sp-tag { font-size:0.76rem; font-weight:700; color:#b0909a; margin-top:4px; opacity:0; animation:slideUp 0.7s cubic-bezier(.2,.8,.4,1) 0.55s forwards; }
.sp-bar-wrap { width:100px; height:4px; background:rgba(217,123,138,0.12); border-radius:2px; margin-top:28px; overflow:hidden; opacity:0; animation:fadeIn 0.4s ease 0.7s forwards; }
.sp-bar { height:100%; width:0%; border-radius:2px; background:linear-gradient(90deg,#f0c080,#d97b8a,#9070c0); animation:grow 2.2s cubic-bezier(.4,0,.2,1) 0.8s forwards; }
@keyframes slideUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes grow{from{width:0%}to{width:100%}}
.splash.hiding { animation:splashOut 0.6s ease-in forwards; }
@keyframes splashOut{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(1.06)}}

/* ‚îÄ‚îÄ LET'S GO SCREEN ‚îÄ‚îÄ */
.ob-screen { min-height:700px; background:linear-gradient(170deg,#fff8f5,#fef0f5); display:flex; flex-direction:column; align-items:center; padding:20px 24px 100px; text-align:center; }
.ob-big { font-size:3.8rem; margin-bottom:12px; }
.ob-h { font-size:1.6rem; font-weight:900; color:#3d2828; line-height:1.2; margin-bottom:8px; }
.ob-h em { color:#c97b3a; font-style:normal; }
.ob-p { font-size:0.82rem; color:#b09090; font-weight:600; line-height:1.65; margin-bottom:22px; }
.lang-row { display:grid; grid-template-columns:1fr 1fr; gap:8px; width:100%; margin-bottom:18px; }
.lang-btn { padding:11px 12px; background:white; border:1.5px solid #fce8e4; border-radius:14px; font-size:0.78rem; font-weight:800; color:#b09090; cursor:pointer; transition:all 0.2s; display:flex; align-items:center; gap:8px; }
.lang-btn:hover,.lang-btn.on { border-color:#d97b8a; color:#d97b8a; background:#fff5f6; }
.ob-toggle { display:flex; justify-content:space-between; align-items:center; width:100%; background:white; border-radius:14px; padding:12px 14px; margin-bottom:8px; border:1.5px solid #fce8e4; }
.ob-tl { font-size:0.8rem; font-weight:800; color:#5a3838; text-align:left; }
.ob-ts { font-size:0.65rem; color:#d0b0b8; font-weight:600; margin-top:2px; }
.toggle { width:42px; height:24px; border-radius:12px; background:#fce8e4; cursor:pointer; position:relative; transition:background 0.25s; flex-shrink:0; }
.toggle.on { background:linear-gradient(135deg,#f09090,#d97b8a); }
.toggle::after { content:''; position:absolute; top:3px; left:3px; width:18px; height:18px; border-radius:50%; background:white; transition:transform 0.25s; box-shadow:0 1px 4px rgba(0,0,0,0.12); }
.toggle.on::after { transform:translateX(18px); }
.promise-box { background:rgba(168,220,168,0.15); border:1px solid rgba(168,197,160,0.3); border-radius:14px; padding:12px 14px; width:100%; margin:12px 0; text-align:left; }
.promise-box strong { font-size:0.75rem; font-weight:800; color:#5a8e6a; display:block; margin-bottom:3px; }
.promise-box span { font-size:0.7rem; color:#8aae8a; font-weight:600; line-height:1.5; }
.ob-btn { width:100%; padding:15px; background:linear-gradient(135deg,#f09090,#d97b8a); color:white; border:none; border-radius:18px; font-size:0.92rem; font-weight:900; cursor:pointer; font-family:'Nunito',sans-serif; box-shadow:0 6px 20px rgba(217,123,138,0.35); transition:all 0.2s; margin-top:6px; }
.ob-btn:hover { transform:translateY(-2px); }

/* ‚îÄ‚îÄ NAME INPUT ‚îÄ‚îÄ */
.name-input-wrap { width:100%; margin-bottom:12px; }
.name-input-label { font-size:0.78rem; font-weight:800; color:#5a3838; margin-bottom:8px; text-align:left; }
.name-input { width:100%; padding:14px 16px; background:white; border:2px solid #fce8e4; border-radius:16px; font-size:1rem; font-family:'Nunito',sans-serif; font-weight:800; color:#3d2828; outline:none; transition:all 0.2s; }
.name-input:focus { border-color:#d97b8a; box-shadow:0 0 0 4px rgba(217,123,138,0.1); }
.name-input::placeholder { color:#ddbec0; font-weight:600; font-size:0.85rem; }
.name-input-hint { font-size:0.68rem; font-weight:700; color:#d0b0b8; margin-top:6px; text-align:left; transition:color 0.2s; }
.name-input-hint.ready { color:#a0c8a8; }

/* ‚îÄ‚îÄ MODE SELECTION ‚îÄ‚îÄ */
.mode-screen { min-height:700px; background:linear-gradient(170deg,#fff8f5,#fef0f5); display:flex; flex-direction:column; align-items:center; padding:20px 22px 100px; text-align:center; }
.mode-h { font-size:1.5rem; font-weight:900; color:#3d2828; line-height:1.25; margin-bottom:6px; }
.mode-h em { color:#d97b8a; font-style:italic; }
.mode-p { font-size:0.78rem; color:#b09090; font-weight:600; line-height:1.6; margin-bottom:24px; }
.mode-cards { width:100%; display:flex; flex-direction:column; gap:12px; }
.mcard { background:white; border:2px solid #fce8e4; border-radius:22px; padding:18px; cursor:pointer; transition:all 0.22s; text-align:left; display:flex; align-items:center; gap:14px; position:relative; overflow:hidden; }
.mcard::before { content:''; position:absolute; inset:0; opacity:0; transition:opacity 0.22s; border-radius:20px; }
.mcard-period::before { background:linear-gradient(135deg,#fff5f6,#fce8f0); }
.mcard-preg::before   { background:linear-gradient(135deg,#f0f4ff,#e8eeff); }
.mcard-ovul::before   { background:linear-gradient(135deg,#f0faf4,#e8faf0); }
.mcard:hover::before  { opacity:1; }
.mcard-period:hover { border-color:#f0b0b8; transform:translateY(-2px); box-shadow:0 8px 24px rgba(217,123,138,0.14); }
.mcard-preg:hover   { border-color:#a0b8e0; transform:translateY(-2px); box-shadow:0 8px 24px rgba(74,112,176,0.14); }
.mcard-ovul:hover   { border-color:#a0d0b0; transform:translateY(-2px); box-shadow:0 8px 24px rgba(90,142,106,0.14); }
.mc-em { font-size:2.4rem; flex-shrink:0; position:relative; z-index:1; }
.mc-txt { position:relative; z-index:1; flex:1; }
.mc-title { font-size:1rem; font-weight:900; color:#3d2828; margin-bottom:3px; }
.mc-desc  { font-size:0.7rem; font-weight:600; color:#b09090; line-height:1.5; }
.mc-arr   { font-size:1.1rem; color:#d0b0b8; position:relative; z-index:1; transition:transform 0.2s; }
.mcard:hover .mc-arr { transform:translateX(4px); color:#d97b8a; }
.mcard-preg:hover  .mc-arr { color:#4a70b0; }
.mcard-ovul:hover  .mc-arr { color:#5a8e6a; }

/* ‚îÄ‚îÄ JOURNEY WIZARD ‚îÄ‚îÄ */
.jrn-screen { min-height:700px; background:linear-gradient(170deg,#fff8f5,#fef0f5); }
.jrn-header { padding:14px 20px 10px; display:flex; align-items:center; gap:12px; }
.jrn-back { width:36px; height:36px; border-radius:50%; background:white; border:1.5px solid #fce8e4; display:flex; align-items:center; justify-content:center; font-size:0.9rem; cursor:pointer; flex-shrink:0; transition:all 0.2s; }
.jrn-back:hover { border-color:#d97b8a; }
.jrn-prog-wrap { flex:1; }
.jrn-prog-bar-bg { height:5px; background:#fce8e4; border-radius:3px; overflow:hidden; margin-bottom:4px; }
.jrn-prog-bar { height:100%; border-radius:3px; background:linear-gradient(90deg,#f09090,#d97b8a); transition:width 0.4s cubic-bezier(.4,0,.2,1); }
.jrn-prog-bar.bl { background:linear-gradient(90deg,#7aa0e0,#4a70b0); }
.jrn-prog-bar.gr { background:linear-gradient(90deg,#78c890,#5a8e6a); }
.jrn-step-txt { font-size:0.58rem; font-weight:800; color:#d0b0b8; text-transform:uppercase; letter-spacing:0.4px; }
.jrn-body { padding:4px 22px 20px; overflow-y:auto; max-height:590px; }
.jrn-icon { font-size:2.8rem; margin-bottom:8px; }
.jrn-q { font-size:1.28rem; font-weight:900; color:#3d2828; line-height:1.3; margin-bottom:5px; }
.jrn-q .cl-bl { color:#4a70b0; } .jrn-q .cl-gr { color:#5a8e6a; } .jrn-q em { color:#d97b8a; font-style:italic; }
.jrn-sub { font-size:0.75rem; color:#b09090; font-weight:600; line-height:1.55; margin-bottom:18px; }
/* chips in journey */
.jchips { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:14px; }
.jchip { padding:9px 14px; background:white; border:1.5px solid #fce8e4; border-radius:22px; font-size:0.76rem; font-weight:700; color:#b09090; cursor:pointer; transition:all 0.18s; display:flex; align-items:center; gap:6px; }
.jchip:hover { border-color:#f0b0b8; color:#d97b8a; }
.jchip.on     { border-color:#d97b8a; background:#fff5f6; color:#d97b8a; }
.jchip.on-bl  { border-color:#4a70b0; background:#f0f4ff; color:#4a70b0; }
.jchip.on-gr  { border-color:#5a8e6a; background:#f0faf4; color:#5a8e6a; }
.jchip-big    { padding:13px 16px; border-radius:16px; width:100%; justify-content:flex-start; }
/* stepper */
.jstepper { background:white; border:2px solid #fce8e4; border-radius:18px; padding:14px 18px; display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; }
.jst-left .jst-lbl { font-size:0.7rem; font-weight:700; color:#b09090; }
.jst-val { font-size:1.7rem; font-weight:900; color:#d97b8a; margin-top:2px; }
.jst-val.bl { color:#4a70b0; } .jst-val.gr { color:#5a8e6a; }
.jst-btns { display:flex; gap:10px; }
.jstb { width:38px; height:38px; border-radius:12px; border:none; font-size:1.3rem; font-weight:900; cursor:pointer; transition:all 0.15s; display:flex; align-items:center; justify-content:center; }
.jstb.pk { background:#fce8e4; color:#d97b8a; } .jstb.pk:hover { background:#d97b8a; color:white; }
.jstb.bl { background:#dde8f8; color:#4a70b0; } .jstb.bl:hover { background:#4a70b0; color:white; }
.jstb.gr { background:#d0e8d8; color:#5a8e6a; } .jstb.gr:hover { background:#5a8e6a; color:white; }
/* date input */
.jdate { width:100%; padding:13px 16px; background:white; border:2px solid #fce8e4; border-radius:15px; font-size:0.9rem; font-family:'Nunito',sans-serif; font-weight:700; color:#5a3838; outline:none; transition:border-color 0.2s; margin-bottom:10px; }
.jdate:focus { border-color:#d97b8a; }
.jdate.bl:focus { border-color:#4a70b0; }
.jdate.gr:focus { border-color:#5a8e6a; }
.skip-link { font-size:0.72rem; color:#d0b0b8; font-weight:700; cursor:pointer; margin-bottom:14px; display:inline-block; text-decoration:underline; text-underline-offset:3px; }
.skip-link:hover { color:#b09090; }
/* journey action btn */
.jrn-btn { width:100%; padding:15px; background:linear-gradient(135deg,#f09090,#d97b8a); color:white; border:none; border-radius:18px; font-size:0.92rem; font-weight:900; cursor:pointer; font-family:'Nunito',sans-serif; box-shadow:0 6px 20px rgba(217,123,138,0.35); transition:all 0.2s; margin-top:6px; }
.jrn-btn:hover { transform:translateY(-2px); }
.jrn-btn.bl { background:linear-gradient(135deg,#7aa0e0,#4a70b0); box-shadow:0 6px 20px rgba(74,112,176,0.3); }
.jrn-btn.gr { background:linear-gradient(135deg,#78c890,#5a8e6a); box-shadow:0 6px 20px rgba(90,142,106,0.3); }
/* warning */
.jrn-warn { background:rgba(255,215,60,0.1); border:1.5px solid rgba(220,180,40,0.22); border-radius:14px; padding:11px 14px; margin-bottom:14px; font-size:0.72rem; font-weight:700; color:#a08020; line-height:1.55; }

/* ‚îÄ‚îÄ HOME ‚îÄ‚îÄ */
.greeting { font-size:0.8rem; color:#d0a0a8; font-weight:700; margin-bottom:2px; }
.name { font-size:1.4rem; font-weight:900; color:#3d2828; margin-bottom:18px; }
.circle-wrap { display:flex; justify-content:center; margin-bottom:20px; }
.cycle-circle { width:170px; height:170px; border-radius:50%; background:linear-gradient(145deg,#fce8e8,#fdd5d5); display:flex; flex-direction:column; align-items:center; justify-content:center; box-shadow:0 8px 30px rgba(217,123,138,0.2),0 0 0 10px rgba(252,232,232,0.5); position:relative; }
.cycle-circle::before { content:''; position:absolute; inset:-8px; border-radius:50%; border:2px dashed rgba(217,123,138,0.2); }
.cycle-circle.bl { background:linear-gradient(145deg,#dde8f8,#c8d8f4); box-shadow:0 8px 30px rgba(74,112,176,0.2),0 0 0 10px rgba(200,216,244,0.4); }
.cycle-circle.bl::before { border-color:rgba(74,112,176,0.2); }
.cycle-circle.gr { background:linear-gradient(145deg,#d4eedd,#bfdfcc); box-shadow:0 8px 30px rgba(90,142,106,0.2),0 0 0 10px rgba(190,230,205,0.4); }
.cycle-circle.gr::before { border-color:rgba(90,142,106,0.2); }
.day-num { font-size:3.2rem; font-weight:900; color:#d97b8a; line-height:1; }
.day-num.bl { color:#4a70b0; } .day-num.gr { color:#5a8e6a; }
.day-label { font-size:0.72rem; font-weight:700; color:#e0a0a8; margin-top:2px; }
.day-label.bl { color:#90b0d0; } .day-label.gr { color:#80b090; }
.phase-label { font-size:0.65rem; font-weight:800; color:white; background:#d97b8a; padding:3px 10px; border-radius:20px; margin-top:6px; }
.phase-label.bl { background:#4a70b0; }
.phase-label.gr { background:#5a8e6a; }
.pills-row { display:flex; gap:8px; justify-content:center; margin-bottom:22px; }
.pill { flex:1; background:white; border-radius:16px; padding:12px 8px; text-align:center; box-shadow:0 2px 10px rgba(200,100,100,0.08); border:1.5px solid #fce8e4; }
.pill-val { font-size:1.3rem; font-weight:900; color:#d97b8a; }
.pill-lbl { font-size:0.6rem; font-weight:700; color:#d0a8b0; margin-top:3px; text-transform:uppercase; letter-spacing:0.3px; }
.cal-title { font-size:0.82rem; font-weight:800; color:#3d2828; margin-bottom:10px; }
.cal { display:grid; grid-template-columns:repeat(7,1fr); gap:4px; }
.ch { font-size:0.58rem; text-align:center; color:#d0a8b0; font-weight:800; text-transform:uppercase; padding:2px 0; }
.cd { aspect-ratio:1; display:flex; align-items:center; justify-content:center; font-size:0.7rem; font-weight:700; color:#c0a0a8; border-radius:50%; cursor:pointer; transition:all 0.15s; }
.cd:hover{background:#fce8e4} .cd.p{background:rgba(252,168,168,0.3);color:#d97b8a} .cd.f{background:rgba(168,220,168,0.25);color:#6a9e6a} .cd.t{background:#d97b8a;color:white;box-shadow:0 3px 10px rgba(217,123,138,0.3)} .cd.e{cursor:default}
.next-banner { background:linear-gradient(135deg,#fff0f2,#fce8f0); border:1.5px solid #fcd0d8; border-radius:18px; padding:14px 16px; display:flex; justify-content:space-between; align-items:center; margin-top:16px; }
.next-banner.bl { background:linear-gradient(135deg,#f0f4ff,#e8eeff); border-color:#c0d0f0; }
.next-banner.gr { background:linear-gradient(135deg,#f0faf4,#e8f5ee); border-color:#b0d8c0; }
.nb-lbl { font-size:0.65rem; font-weight:800; color:#d0a0a8; text-transform:uppercase; letter-spacing:0.4px; }
.nb-lbl.bl { color:#90b0d8; } .nb-lbl.gr { color:#80b09a; }
.nb-val { font-size:1.1rem; font-weight:900; color:#3d2828; margin-top:2px; }
.nb-sub { font-size:0.68rem; color:#d0a0b0; font-weight:700; margin-top:1px; }
.nb-ring { position:relative; width:50px; height:50px; }
.nb-ring svg { transform:rotate(-90deg); }
.nb-pct { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:0.65rem; font-weight:900; color:#d97b8a; }
.nb-pct.bl { color:#4a70b0; } .nb-pct.gr { color:#5a8e6a; }
/* switch mode card */
.switch-mode-card { background:white; border:1.5px solid #fce8e4; border-radius:18px; padding:14px 16px; margin-top:14px; }
.sm-title { font-size:0.7rem; font-weight:900; color:#c0a0a8; text-transform:uppercase; letter-spacing:0.5px; margin-bottom:10px; }
.sm-btn { width:100%; padding:11px 14px; border:1.5px solid #fce8e4; background:#fff8f5; border-radius:14px; font-size:0.78rem; font-weight:800; color:#b09090; cursor:pointer; font-family:'Nunito',sans-serif; transition:all 0.2s; display:flex; align-items:center; justify-content:space-between; margin-bottom:7px; }
.sm-btn:last-child { margin-bottom:0; }
.sm-btn:hover { border-color:#d97b8a; color:#d97b8a; background:#fff5f6; }
.sm-btn.urgent { border-color:rgba(217,123,138,0.35); background:rgba(255,245,246,0.8); }
.sm-btn.urgent:hover { border-color:#d97b8a; }
/* pregnancy home extras */
.baby-card { background:linear-gradient(135deg,#f0f4ff,#e8eeff); border:1.5px solid #c8d8f4; border-radius:18px; padding:14px 16px; margin-bottom:14px; }
.bc-week { font-size:0.65rem; font-weight:800; color:#7090c0; text-transform:uppercase; letter-spacing:0.5px; margin-bottom:4px; }
.bc-title { font-size:1rem; font-weight:900; color:#3d2828; margin-bottom:3px; }
.bc-sub { font-size:0.73rem; color:#7090b0; font-weight:600; line-height:1.5; }
.bc-size { font-size:2.2rem; margin-bottom:4px; }
/* ovulation home extras */
.fertile-bar-wrap { background:white; border:1.5px solid #d0e8d8; border-radius:18px; padding:14px 16px; margin-bottom:14px; }
.fb-title { font-size:0.72rem; font-weight:900; color:#5a8e6a; margin-bottom:10px; }
.fb-track { height:10px; background:#e8f5ee; border-radius:5px; overflow:hidden; margin-bottom:6px; }
.fb-fill { height:100%; border-radius:5px; background:linear-gradient(90deg,#78c890,#5a8e6a); }
.fb-labels { display:flex; justify-content:space-between; font-size:0.6rem; font-weight:800; color:#a0c8b0; }

/* ‚îÄ‚îÄ LOG ‚îÄ‚îÄ */
.log-date { font-size:0.72rem; font-weight:800; color:#d0a0a8; text-transform:uppercase; letter-spacing:0.5px; margin-bottom:16px; }
.flow-row { display:flex; gap:10px; justify-content:space-between; margin-bottom:4px; }
.flow-btn { flex:1; padding:14px 4px; background:white; border-radius:16px; text-align:center; cursor:pointer; border:2px solid #fce8e4; transition:all 0.2s; }
.flow-btn:hover { border-color:#f0b0b8; transform:translateY(-2px); }
.flow-btn.on { border-color:#d97b8a; background:linear-gradient(135deg,#fff5f6,white); box-shadow:0 4px 14px rgba(217,123,138,0.18); }
.flow-icon { font-size:1.5rem; } .flow-lbl { font-size:0.6rem; font-weight:800; color:#d0a8b0; margin-top:4px; text-transform:uppercase; }
.flow-btn.on .flow-lbl { color:#d97b8a; }
.mood-row { display:flex; gap:8px; justify-content:space-between; }
.mood-btn { flex:1; padding:12px 4px; background:white; border-radius:14px; text-align:center; cursor:pointer; border:2px solid #fce8e4; transition:all 0.2s; font-size:1.4rem; }
.mood-btn:hover { transform:scale(1.08); }
.mood-btn.on { border-color:#a8d0b8; background:#f0faf4; }
.chips { display:flex; flex-wrap:wrap; gap:7px; }
.chip { padding:8px 14px; background:white; border:1.5px solid #fce8e4; border-radius:20px; font-size:0.72rem; font-weight:700; color:#c0a0a8; cursor:pointer; transition:all 0.15s; }
.chip:hover { border-color:#f0b0c0; color:#d97b8a; }
.chip.on { border-color:#c8b0e0; background:#f5f0fc; color:#9870c0; }
.note { width:100%; background:white; border:1.5px solid #fce8e4; border-radius:16px; padding:12px 14px; font-size:0.8rem; font-family:'Nunito',sans-serif; color:#5a3838; resize:none; outline:none; min-height:68px; transition:border-color 0.2s; font-weight:600; }
.note:focus { border-color:#f0b0b8; }
.note::placeholder { color:#ddbec0; }
/* log input for numbers */
.log-stepper-row { display:flex; gap:10px; margin-bottom:4px; }
.log-step { flex:1; background:white; border:1.5px solid #fce8e4; border-radius:14px; padding:11px 12px; }
.ls-lbl { font-size:0.62rem; font-weight:800; color:#d0b0b8; margin-bottom:6px; }
.ls-ctrl { display:flex; justify-content:space-between; align-items:center; }
.ls-val { font-size:1.25rem; font-weight:900; color:#d97b8a; }
.ls-val.bl { color:#4a70b0; } .ls-val.gr { color:#5a8e6a; }
.lsb { width:26px; height:26px; border-radius:8px; border:none; font-size:1rem; font-weight:900; cursor:pointer; transition:all 0.15s; display:flex; align-items:center; justify-content:center; }
.lsb.pk { background:#fce8e4; color:#d97b8a; } .lsb.pk:hover { background:#d97b8a; color:white; }
.lsb.bl { background:#dde8f8; color:#4a70b0; } .lsb.bl:hover { background:#4a70b0; color:white; }
.lsb.gr { background:#d0e8d8; color:#5a8e6a; } .lsb.gr:hover { background:#5a8e6a; color:white; }
/* kick counter */
.kick-wrap { background:linear-gradient(135deg,#f0f4ff,#e8eeff); border:1.5px solid #c0d0f0; border-radius:20px; padding:20px; text-align:center; margin-bottom:14px; }
.kick-label { font-size:0.7rem; font-weight:800; color:#7090c0; text-transform:uppercase; letter-spacing:0.5px; margin-bottom:8px; }
.kick-num { font-size:3.5rem; font-weight:900; color:#4a70b0; line-height:1; margin-bottom:12px; transition:transform 0.15s; }
.kick-btn { width:70px; height:70px; border-radius:50%; border:none; background:linear-gradient(135deg,#7aa0e0,#4a70b0); color:white; font-size:2rem; cursor:pointer; box-shadow:0 6px 20px rgba(74,112,176,0.35); transition:all 0.15s; display:flex; align-items:center; justify-content:center; margin:0 auto; }
.kick-btn:active { transform:scale(0.9); }
/* BBT input */
.bbt-input-wrap { background:white; border:2px solid #d0e8d8; border-radius:16px; padding:14px; margin-bottom:12px; }
.bbt-lbl { font-size:0.68rem; font-weight:800; color:#80b090; text-transform:uppercase; margin-bottom:8px; }
.bbt-inp { width:100%; font-size:2rem; font-weight:900; color:#5a8e6a; border:none; outline:none; font-family:'Nunito',sans-serif; background:transparent; text-align:center; }
.bbt-unit { font-size:0.7rem; color:#a0c0b0; font-weight:700; text-align:center; margin-top:2px; }
/* mucus chips variant */
.chip.on-gr { border-color:#a0d0b0; background:#f0faf4; color:#5a8e6a; }
.chip.on-bl { border-color:#a0b8e0; background:#f0f4ff; color:#4a70b0; }

/* ‚îÄ‚îÄ INSIGHTS ‚îÄ‚îÄ */
.big-insight { background:linear-gradient(135deg,#fce8e8,#fce8f8); border-radius:22px; padding:18px; margin-bottom:16px; text-align:center; border:1.5px solid #fcd0d8; }
.big-insight.bl { background:linear-gradient(135deg,#e8eeff,#dde8f8); border-color:#b8c8f0; }
.big-insight.gr { background:linear-gradient(135deg,#e8f5ee,#d8eee0); border-color:#a8d0b8; }
.bi-emoji { font-size:2.5rem; margin-bottom:6px; }
.bi-title { font-size:1rem; font-weight:900; color:#3d2828; margin-bottom:4px; }
.bi-sub { font-size:0.75rem; color:#c0a0a8; font-weight:600; line-height:1.5; }
.bi-sub.bl { color:#7090b0; } .bi-sub.gr { color:#6a9a7a; }
.insight-card { background:white; border-radius:18px; padding:15px 16px; margin-bottom:10px; border:1.5px solid #fce8e4; }
.insight-card.bl { border-color:#dde8f8; } .insight-card.gr { border-color:#d0e8d8; }
.ic-head { font-size:0.78rem; font-weight:900; color:#3d2828; margin-bottom:10px; }
.bar-row { display:flex; align-items:center; gap:10px; margin-bottom:8px; }
.bar-row:last-child { margin-bottom:0; }
.bar-name { font-size:0.72rem; font-weight:700; color:#c0a0a8; min-width:68px; }
.bar-track { flex:1; height:8px; background:#fce8e4; border-radius:4px; overflow:hidden; }
.bar-track.bl { background:#dde8f8; } .bar-track.gr { background:#d0e8d8; }
.bar-fill { height:100%; border-radius:4px; }
.bar-num { font-size:0.7rem; font-weight:800; color:#d97b8a; min-width:28px; text-align:right; }
.mini-chart { display:flex; align-items:flex-end; gap:6px; height:70px; margin-bottom:6px; }
.mc-bar { flex:1; border-radius:6px 6px 0 0; background:linear-gradient(0deg,#f09090,#fdd0d0); cursor:pointer; transition:filter 0.2s; }
.mc-bar:hover { filter:brightness(0.9); }
.mc-bar.hi { background:linear-gradient(0deg,#d97b8a,#f0a0b0); }
.mc-bar.bl { background:linear-gradient(0deg,#7aa0e0,#c8d8f4); }
.mc-bar.bl.hi { background:linear-gradient(0deg,#4a70b0,#8ab0e0); }
.mc-bar.gr { background:linear-gradient(0deg,#78c890,#c0e8d0); }
.mc-bar.gr.hi { background:linear-gradient(0deg,#5a8e6a,#90c8a0); }
.mc-labels { display:flex; gap:6px; }
.mc-lbl { flex:1; text-align:center; font-size:0.58rem; font-weight:800; color:#d0b0b8; text-transform:uppercase; }
.upcoming-row { display:flex; justify-content:space-between; align-items:center; padding:11px 13px; border-radius:13px; margin-bottom:7px; font-size:0.78rem; font-weight:700; }
.upcoming-row:last-child { margin-bottom:0; }
.ur-period  { background:rgba(252,168,168,0.15); border:1px solid rgba(252,168,168,0.3); color:#c87878; }
.ur-fertile { background:rgba(168,220,168,0.15); border:1px solid rgba(168,220,168,0.3); color:#6a9e6a; }
.ur-ov      { background:rgba(197,184,216,0.15); border:1px solid rgba(197,184,216,0.3); color:#9870c0; }
.ur-appt    { background:rgba(140,168,220,0.15); border:1px solid rgba(140,168,220,0.3); color:#4a70b0; }
.ur-kick    { background:rgba(100,160,220,0.12); border:1px solid rgba(100,160,220,0.28); color:#4a70b0; }
/* BBT chart */
.bbt-chart-wrap { display:flex; align-items:flex-end; gap:3px; height:60px; margin-bottom:8px; position:relative; }
.bbt-bar { flex:1; border-radius:3px 3px 0 0; background:linear-gradient(0deg,#78c890,#c0e8d0); min-height:8px; transition:filter 0.2s; }
.bbt-bar.peak { background:linear-gradient(0deg,#5a8e6a,#90c8a0); }
.bbt-bar.pre  { background:linear-gradient(0deg,#d0e8d8,#e8f5ee); }
.bbt-ov-line  { position:absolute; top:0; bottom:0; width:1.5px; background:rgba(217,123,138,0.5); border-radius:2px; }
.bbt-chart-lbl { display:flex; justify-content:space-between; font-size:0.58rem; font-weight:800; color:#a0c0b0; }

/* ‚îÄ‚îÄ LEARN ‚îÄ‚îÄ */
.search-box { width:100%; padding:11px 16px; background:white; border:1.5px solid #fce8e4; border-radius:20px; font-size:0.8rem; font-family:'Nunito',sans-serif; outline:none; color:#5a3838; font-weight:600; margin-bottom:14px; transition:border-color 0.2s; }
.search-box:focus { border-color:#f0b0b8; }
.search-box::placeholder { color:#ddbec0; }
.cat-scroll { display:flex; gap:7px; overflow-x:auto; margin-bottom:14px; scrollbar-width:none; }
.cat-scroll::-webkit-scrollbar { display:none; }
.cat-btn { padding:7px 15px; background:white; border-radius:20px; font-size:0.72rem; font-weight:800; cursor:pointer; border:1.5px solid #fce8e4; transition:all 0.2s; white-space:nowrap; color:#c0a0a8; flex-shrink:0; }
.cat-btn:hover { border-color:#f0b0b8; color:#d97b8a; }
.cat-btn.on { border-color:#d97b8a; background:linear-gradient(135deg,#fff5f6,white); color:#d97b8a; }
.cat-btn.on-bl { border-color:#4a70b0; background:linear-gradient(135deg,#f0f4ff,white); color:#4a70b0; }
.cat-btn.on-gr { border-color:#5a8e6a; background:linear-gradient(135deg,#f0faf4,white); color:#5a8e6a; }
.article { background:white; border-radius:18px; padding:14px 15px; margin-bottom:10px; border:1.5px solid #fce8e4; display:flex; gap:12px; align-items:center; cursor:pointer; transition:all 0.2s; }
.article:hover { border-color:#f0b0b8; transform:translateX(3px); }
.art-icon { font-size:1.8rem; flex-shrink:0; }
.art-tag { display:inline-block; padding:2px 9px; border-radius:10px; font-size:0.6rem; font-weight:800; margin-bottom:4px; }
.tag-g { background:rgba(168,220,168,0.25); color:#5a8e5a; }
.tag-p { background:rgba(252,168,168,0.2); color:#c87878; }
.tag-m { background:rgba(197,184,216,0.25); color:#8870b0; }
.tag-h { background:rgba(255,220,140,0.3); color:#a07820; }
.tag-d { background:rgba(140,200,230,0.25); color:#3a80a0; }
.tag-b { background:rgba(140,168,220,0.2); color:#4a70b0; }
.tag-n { background:rgba(168,220,168,0.2); color:#5a8e6a; }
.art-title { font-size:0.8rem; font-weight:800; color:#3d2828; line-height:1.35; }
.art-meta  { font-size:0.65rem; color:#d0b0b8; font-weight:700; margin-top:3px; }

/* ‚îÄ‚îÄ PRIVACY ‚îÄ‚îÄ */
.trust-box { background:linear-gradient(135deg,#f0faf4,#f5f0fc); border:1.5px solid rgba(168,197,160,0.3); border-radius:22px; padding:22px 18px; text-align:center; margin-bottom:16px; }
.trust-emoji { font-size:2.8rem; margin-bottom:8px; }
.trust-title { font-size:1rem; font-weight:900; color:#3d2828; margin-bottom:6px; }
.trust-text { font-size:0.75rem; color:#8a7080; line-height:1.6; font-weight:600; }
.trust-badges { display:flex; flex-wrap:wrap; justify-content:center; gap:6px; margin-top:12px; }
.tbadge { padding:5px 11px; background:white; border-radius:20px; font-size:0.62rem; font-weight:800; color:#a08090; border:1px solid #ece0e8; }
.priv-card { background:white; border-radius:18px; padding:14px 16px; margin-bottom:10px; border:1.5px solid #fce8e4; }
.priv-head { font-size:0.8rem; font-weight:900; color:#3d2828; margin-bottom:10px; }
.toggle-row { display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-bottom:1px solid #fce8e4; }
.toggle-row:last-child { border-bottom:none; padding-bottom:0; }
.trow-label { font-size:0.78rem; font-weight:700; color:#5a3838; }
.trow-sub   { font-size:0.65rem; color:#d0b0b8; margin-top:2px; font-weight:600; }
.out-btn { width:100%; padding:12px; background:white; border:1.5px solid #f0b0b8; color:#d97b8a; border-radius:16px; font-size:0.82rem; font-weight:800; cursor:pointer; font-family:'Nunito',sans-serif; transition:all 0.2s; margin-top:7px; }
.out-btn:hover { background:#fff5f6; }
.del-btn { width:100%; padding:12px; background:rgba(220,80,80,0.06); border:1.5px solid rgba(220,80,80,0.2); color:#c05050; border-radius:16px; font-size:0.82rem; font-weight:800; cursor:pointer; font-family:'Nunito',sans-serif; transition:all 0.2s; margin-top:7px; }

/* ‚îÄ‚îÄ CENTER + BUTTON ‚îÄ‚îÄ */
.nav-plus-slot { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; position:relative; }
.nav-plus-btn { width:52px; height:52px; border-radius:50%; background:linear-gradient(135deg,#f09090,#d97b8a); color:white; font-size:1.9rem; font-weight:300; cursor:pointer; display:flex; align-items:center; justify-content:center; box-shadow:0 6px 20px rgba(217,123,138,0.45), 0 0 0 4px white, 0 0 0 5px rgba(217,123,138,0.15); position:absolute; top:-22px; line-height:1; transition:all 0.2s; user-select:none; border:none; font-family:'Nunito',sans-serif; }
.nav-plus-btn:hover { transform:scale(1.1) translateY(-2px); box-shadow:0 10px 28px rgba(217,123,138,0.5), 0 0 0 4px white, 0 0 0 5px rgba(217,123,138,0.2); }
.nav-plus-btn.bl { background:linear-gradient(135deg,#7aa0e0,#4a70b0); box-shadow:0 6px 20px rgba(74,112,176,0.45), 0 0 0 4px white, 0 0 0 5px rgba(74,112,176,0.15); }
.nav-plus-btn.bl:hover { box-shadow:0 10px 28px rgba(74,112,176,0.5), 0 0 0 4px white; }
.nav-plus-btn.gr { background:linear-gradient(135deg,#78c890,#5a8e6a); box-shadow:0 6px 20px rgba(90,142,106,0.45), 0 0 0 4px white, 0 0 0 5px rgba(90,142,106,0.15); }
.nav-plus-btn.gr:hover { box-shadow:0 10px 28px rgba(90,142,106,0.5), 0 0 0 4px white; }

/* ‚îÄ‚îÄ SELF-CARE SCREEN ‚îÄ‚îÄ */
.care-hero { background:linear-gradient(135deg,#fff0f0,#fde8f0,#f5e8fc); border-radius:22px; padding:18px; margin-bottom:14px; text-align:center; border:1.5px solid #fcd0e8; position:relative; overflow:hidden; }
.care-hero::before { content:''; position:absolute; inset:0; background:radial-gradient(circle at 80% 20%, rgba(255,192,220,0.25) 0%, transparent 70%); pointer-events:none; }
.care-hero-badge { display:inline-block; padding:4px 12px; background:rgba(217,123,138,0.12); border:1px solid rgba(217,123,138,0.2); border-radius:20px; font-size:0.62rem; font-weight:900; color:#d97b8a; text-transform:uppercase; letter-spacing:0.5px; margin-bottom:8px; }
.care-hero-badge.bl { background:rgba(74,112,176,0.1); border-color:rgba(74,112,176,0.2); color:#4a70b0; }
.care-hero-badge.gr { background:rgba(90,142,106,0.1); border-color:rgba(90,142,106,0.2); color:#5a8e6a; }
.care-hero-title { font-size:1.05rem; font-weight:900; color:#3d2828; margin-bottom:5px; position:relative; z-index:1; }
.care-hero-desc { font-size:0.76rem; color:#c0909a; font-weight:600; line-height:1.5; position:relative; z-index:1; }
.care-hero-emoji { font-size:2.6rem; margin-bottom:8px; position:relative; z-index:1; }
.care-action-btn { margin-top:12px; padding:10px 22px; background:linear-gradient(135deg,#f09090,#d97b8a); color:white; border:none; border-radius:14px; font-size:0.78rem; font-weight:800; cursor:pointer; font-family:'Nunito',sans-serif; transition:all 0.2s; position:relative; z-index:1; }
.care-action-btn:hover { transform:translateY(-1px); }
.care-action-btn.bl { background:linear-gradient(135deg,#7aa0e0,#4a70b0); }
.care-action-btn.gr { background:linear-gradient(135deg,#78c890,#5a8e6a); }

/* affirmation card */
.affirmation-card { background:linear-gradient(135deg,#fffbf0,#fff5e8); border:1.5px solid #fde8c8; border-radius:20px; padding:16px; margin-bottom:10px; position:relative; overflow:hidden; cursor:pointer; transition:all 0.2s; }
.affirmation-card:hover { transform:translateY(-1px); box-shadow:0 6px 18px rgba(200,140,80,0.12); }
.affirmation-card::before { content:''; position:absolute; top:-20px; right:-20px; width:80px; height:80px; border-radius:50%; background:rgba(255,200,100,0.1); }
.aff-label { font-size:0.6rem; font-weight:900; color:#c09050; text-transform:uppercase; letter-spacing:0.5px; margin-bottom:6px; }
.aff-text { font-size:0.9rem; font-weight:800; color:#3d2828; line-height:1.45; }
.aff-tap { font-size:0.62rem; color:#d0b080; font-weight:700; margin-top:8px; }

/* habit trackers */
.habit-row { display:flex; gap:8px; margin-bottom:10px; }
.habit-card { flex:1; background:white; border:1.5px solid #fce8e4; border-radius:16px; padding:12px 10px; text-align:center; }
.habit-icon { font-size:1.4rem; margin-bottom:4px; }
.habit-val { font-size:1.4rem; font-weight:900; color:#d97b8a; }
.habit-lbl { font-size:0.58rem; font-weight:800; color:#d0b0b8; text-transform:uppercase; margin-top:2px; }
.habit-card.gr { border-color:#d0e8d8; } .habit-card.gr .habit-val { color:#5a8e6a; }
.habit-card.bl { border-color:#dde8f8; } .habit-card.bl .habit-val { color:#4a70b0; }
.habit-card.yl { border-color:#fde8c0; } .habit-card.yl .habit-val { color:#c09050; }

/* breathe button */
.breathe-card { background:linear-gradient(135deg,#f0f5fc,#e8ecf8); border:1.5px solid #d0d8f0; border-radius:20px; padding:16px; margin-bottom:10px; display:flex; align-items:center; gap:14px; cursor:pointer; transition:all 0.2s; }
.breathe-card:hover { transform:translateY(-1px); box-shadow:0 6px 18px rgba(100,120,200,0.12); }
.breathe-orb { width:52px; height:52px; border-radius:50%; background:linear-gradient(135deg,#a0b8e8,#7090d0); display:flex; align-items:center; justify-content:center; font-size:1.6rem; flex-shrink:0; animation:breatheOrb 4s ease-in-out infinite; }
@keyframes breatheOrb { 0%,100%{transform:scale(1)} 50%{transform:scale(1.1)} }
.breathe-text { flex:1; }
.breathe-title { font-size:0.85rem; font-weight:900; color:#3d2828; margin-bottom:3px; }
.breathe-sub { font-size:0.7rem; color:#909ad0; font-weight:600; }
.breathe-start { padding:7px 14px; background:linear-gradient(135deg,#8aabe0,#6080c8); color:white; border:none; border-radius:10px; font-size:0.72rem; font-weight:800; cursor:pointer; font-family:'Nunito',sans-serif; }

/* ritual cards */
.ritual-card { background:white; border:1.5px solid #fce8e4; border-radius:18px; padding:13px 15px; margin-bottom:9px; display:flex; align-items:center; gap:12px; cursor:pointer; transition:all 0.18s; }
.ritual-card:hover { border-color:#f0b0b8; transform:translateX(3px); }
.ritual-icon { font-size:1.8rem; width:40px; text-align:center; flex-shrink:0; }
.ritual-info { flex:1; }
.ritual-title { font-size:0.82rem; font-weight:900; color:#3d2828; margin-bottom:2px; }
.ritual-sub { font-size:0.68rem; color:#d0b0b8; font-weight:600; }
.ritual-dur { font-size:0.62rem; font-weight:800; color:#d97b8a; background:rgba(217,123,138,0.1); padding:2px 8px; border-radius:8px; }
.ritual-card.bl { border-color:#dde8f8; } .ritual-card.bl:hover { border-color:#a0b8e0; }
.ritual-card.gr { border-color:#d0e8d8; } .ritual-card.gr:hover { border-color:#90c8a8; }
.ritual-card.bl .ritual-dur { color:#4a70b0; background:rgba(74,112,176,0.1); }
.ritual-card.gr .ritual-dur { color:#5a8e6a; background:rgba(90,142,106,0.1); }

/* phase wheel strip */
.phase-strip { display:flex; gap:6px; margin-bottom:14px; }
.phase-chip { flex:1; padding:8px 4px; background:white; border:1.5px solid #fce8e4; border-radius:12px; text-align:center; font-size:0.58rem; font-weight:800; color:#d0b0b8; cursor:pointer; transition:all 0.18s; user-select:none; }
.phase-chip:hover { border-color:#f0b0b8; color:#d97b8a; transform:translateY(-1px); }
.phase-chip.active-phase { border-color:#d97b8a; background:linear-gradient(135deg,#fff5f6,white); color:#d97b8a; box-shadow:0 3px 10px rgba(217,123,138,0.15); }
.phase-chip.active-phase.gr { border-color:#5a8e6a; background:linear-gradient(135deg,#f0faf4,white); color:#5a8e6a; box-shadow:0 3px 10px rgba(90,142,106,0.15); }
.phase-chip.active-phase.bl { border-color:#4a70b0; background:linear-gradient(135deg,#f0f4ff,white); color:#4a70b0; box-shadow:0 3px 10px rgba(74,112,176,0.15); }
.phase-em { font-size:1.1rem; margin-bottom:2px; }

/* ‚îÄ‚îÄ RITUAL SESSION OVERLAY ‚îÄ‚îÄ */
.ritual-overlay { position:absolute; inset:0; z-index:200; background:#fff8f5; border-radius:44px; display:flex; flex-direction:column; transform:translateY(100%); transition:transform 0.4s cubic-bezier(.4,0,.2,1); overflow:hidden; }
.ritual-overlay.open { transform:translateY(0); }
.ritual-overlay.bl { background:#f4f7ff; }
.ritual-overlay.gr { background:#f2fbf5; }

.ro-header { padding:18px 20px 10px; display:flex; align-items:center; justify-content:space-between; flex-shrink:0; }
.ro-close { width:34px; height:34px; border-radius:50%; background:rgba(217,123,138,0.1); border:none; font-size:1rem; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all 0.2s; }
.ro-close:hover { background:rgba(217,123,138,0.2); }
.ro-close.bl { background:rgba(74,112,176,0.1); }
.ro-close.gr { background:rgba(90,142,106,0.1); }
.ro-title { font-size:0.85rem; font-weight:900; color:#3d2828; }
.ro-step-lbl { font-size:0.68rem; font-weight:800; color:#d0b0b8; }

.ro-progress-bar-bg { height:3px; background:#fce8e4; margin:0 20px 0; border-radius:2px; overflow:hidden; flex-shrink:0; }
.ro-progress-bar-bg.bl { background:#dde8f8; }
.ro-progress-bar-bg.gr { background:#d0e8d8; }
.ro-progress-bar { height:100%; border-radius:2px; background:linear-gradient(90deg,#f09090,#d97b8a); transition:width 0.4s ease; }
.ro-progress-bar.bl { background:linear-gradient(90deg,#7aa0e0,#4a70b0); }
.ro-progress-bar.gr { background:linear-gradient(90deg,#78c890,#5a8e6a); }

.ro-body { flex:1; display:flex; flex-direction:column; align-items:center; padding:20px 24px 10px; overflow-y:auto; }

.ro-ritual-icon { font-size:4rem; margin-bottom:12px; animation:ritualPulse 2s ease-in-out infinite; }
@keyframes ritualPulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.06)} }

.ro-ritual-name { font-size:1.25rem; font-weight:900; color:#3d2828; text-align:center; margin-bottom:6px; line-height:1.3; }
.ro-ritual-desc { font-size:0.8rem; font-weight:600; color:#b09090; text-align:center; line-height:1.6; margin-bottom:24px; max-width:260px; }
.ro-ritual-desc.bl { color:#7090b0; }
.ro-ritual-desc.gr { color:#6a9a7a; }

/* circular timer */
.ro-timer-wrap { position:relative; width:130px; height:130px; margin-bottom:20px; }
.ro-timer-svg { transform:rotate(-90deg); }
.ro-timer-bg { fill:none; stroke:#fce8e4; stroke-width:7; }
.ro-timer-bg.bl { stroke:#dde8f8; }
.ro-timer-bg.gr { stroke:#d0e8d8; }
.ro-timer-arc { fill:none; stroke:#d97b8a; stroke-width:7; stroke-linecap:round; transition:stroke-dashoffset 1s linear; }
.ro-timer-arc.bl { stroke:#4a70b0; }
.ro-timer-arc.gr { stroke:#5a8e6a; }
.ro-timer-center { position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; }
.ro-timer-time { font-size:1.8rem; font-weight:900; color:#3d2828; line-height:1; }
.ro-timer-unit { font-size:0.62rem; font-weight:800; color:#d0b0b8; margin-top:2px; text-transform:uppercase; }

.ro-done-tick { font-size:3.5rem; animation:tickBounce 0.4s cubic-bezier(.2,1.4,.4,1); }
@keyframes tickBounce { from{transform:scale(0)} to{transform:scale(1)} }

.ro-tip { background:rgba(255,220,140,0.15); border:1px solid rgba(220,180,40,0.2); border-radius:12px; padding:10px 14px; font-size:0.72rem; font-weight:700; color:#a08020; line-height:1.5; text-align:center; margin-bottom:16px; width:100%; }

/* checklist */
.ro-checklist { width:100%; display:flex; flex-direction:column; gap:7px; margin-bottom:16px; }
.ro-check-item { display:flex; align-items:center; gap:10px; background:white; border:1.5px solid #fce8e4; border-radius:13px; padding:10px 13px; font-size:0.78rem; font-weight:700; color:#5a3838; transition:all 0.2s; }
.ro-check-item.done { background:#f0faf4; border-color:#a0d0b0; color:#5a8e6a; }
.ro-check-item.done.bl-done { background:#f0f4ff; border-color:#a0b8e0; color:#4a70b0; }
.ro-check-box { width:22px; height:22px; border-radius:7px; border:2px solid #e0b0b8; flex-shrink:0; display:flex; align-items:center; justify-content:center; font-size:0.85rem; transition:all 0.2s; }
.ro-check-item.done .ro-check-box { background:#5a8e6a; border-color:#5a8e6a; color:white; }
.ro-check-item.done.bl-done .ro-check-box { background:#4a70b0; border-color:#4a70b0; color:white; }

/* footer buttons */
.ro-footer { padding:12px 20px 22px; display:flex; gap:10px; flex-shrink:0; }
.ro-btn-skip { flex:1; padding:14px; background:white; border:1.5px solid #fce8e4; border-radius:16px; font-size:0.82rem; font-weight:800; color:#b09090; cursor:pointer; font-family:'Nunito',sans-serif; transition:all 0.2s; }
.ro-btn-skip:hover { border-color:#d0b0b8; }
.ro-btn-next { flex:2; padding:14px; background:linear-gradient(135deg,#f09090,#d97b8a); color:white; border:none; border-radius:16px; font-size:0.88rem; font-weight:900; cursor:pointer; font-family:'Nunito',sans-serif; box-shadow:0 5px 16px rgba(217,123,138,0.35); transition:all 0.2s; }
.ro-btn-next:hover { transform:translateY(-1px); }
.ro-btn-next.bl { background:linear-gradient(135deg,#7aa0e0,#4a70b0); box-shadow:0 5px 16px rgba(74,112,176,0.3); }
.ro-btn-next.gr { background:linear-gradient(135deg,#78c890,#5a8e6a); box-shadow:0 5px 16px rgba(90,142,106,0.3); }

/* completion screen */
.ro-complete { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:24px; text-align:center; }
.ro-complete-em { font-size:4rem; margin-bottom:14px; animation:completePop 0.5s cubic-bezier(.2,1.4,.4,1); }
@keyframes completePop { from{transform:scale(0) rotate(-15deg)} to{transform:scale(1) rotate(0)} }
.ro-complete-title { font-size:1.4rem; font-weight:900; color:#3d2828; margin-bottom:6px; }
.ro-complete-sub { font-size:0.8rem; color:#b09090; font-weight:600; line-height:1.6; margin-bottom:20px; }
.ro-streak { background:linear-gradient(135deg,#fff0f0,#fde8f0); border:1.5px solid #fcd0d8; border-radius:16px; padding:14px 18px; width:100%; margin-bottom:16px; }
.ro-streak-val { font-size:2rem; font-weight:900; color:#d97b8a; }
.ro-streak-lbl { font-size:0.7rem; font-weight:800; color:#d0a0a8; text-transform:uppercase; letter-spacing:0.4px; }

/* care tip strip */
.care-tip-strip { display:flex; flex-direction:column; gap:6px; margin-bottom:14px; }
.ctp { display:flex; align-items:flex-start; gap:8px; padding:9px 12px; border-radius:12px; font-size:0.7rem; font-weight:700; line-height:1.45; }
.ctp.mood  { background:rgba(197,184,216,0.15); border:1px solid rgba(197,184,216,0.3); color:#8870b0; }
.ctp.food  { background:rgba(168,220,168,0.15); border:1px solid rgba(168,220,168,0.3); color:#5a8e5a; }
.ctp.avoid { background:rgba(255,200,100,0.12); border:1px solid rgba(220,180,40,0.22); color:#a08020; }
.ctp-ico { flex-shrink:0; font-size:0.85rem; }
.ctp-txt { flex:1; }
</style>
</head>
<body>
<div class="phone">
  <div class="notch"><div class="notch-inner"></div></div>
  <div class="status"><span>9:41</span><span>üîã üì∂</span></div>

  <!-- ‚ïê‚ïê SPLASH ‚ïê‚ïê -->
  <div id="s-splash" class="splash">
    <div class="sp-petals">
      <div class="sp-p" style="left:6%;font-size:1.3rem;animation-duration:4.4s;animation-delay:0.2s">üå∏</div>
      <div class="sp-p" style="left:20%;font-size:1rem;animation-duration:5.2s;animation-delay:1s">‚úø</div>
      <div class="sp-p" style="left:35%;font-size:1.6rem;animation-duration:3.9s;animation-delay:0.4s">üå∫</div>
      <div class="sp-p" style="left:52%;font-size:0.9rem;animation-duration:4.8s;animation-delay:1.8s">üå∏</div>
      <div class="sp-p" style="left:66%;font-size:1.2rem;animation-duration:5.5s;animation-delay:0.7s">‚úæ</div>
      <div class="sp-p" style="left:80%;font-size:1.5rem;animation-duration:4s;animation-delay:2.2s">üå∏</div>
      <div class="sp-p" style="left:90%;font-size:1rem;animation-duration:4.6s;animation-delay:0.9s">‚úø</div>
    </div>
    <div class="sp-rings">
      <div class="sp-ring"></div><div class="sp-ring"></div><div class="sp-ring"></div>
    </div>
    <div class="sp-logo"><span>üå∏</span></div>
    <div class="sp-name"><em>Sol</em>una</div>
    <div class="sp-tag">your light. your rhythm. üåï</div>
    <div class="sp-bar-wrap"><div class="sp-bar"></div></div>
  </div>

  <!-- ‚ïê‚ïê LET'S GO ‚ïê‚ïê -->
  <div id="s-ob" class="screen" style="padding:0">
    <div class="ob-screen">
      <div class="ob-big">üå∏</div>
      <div class="ob-h">Welcome to<br><em>Soluna</em></div>
      <div class="ob-p">Your light. Your rhythm. Your privacy.<br>Cycle tracking that truly understands you. üåø</div>
      <div class="lang-row">
        <div class="lang-btn on" onclick="selLang(this)">üá¨üáß English</div>
        <div class="lang-btn" onclick="selLang(this)">üá≤üáæ Melayu</div>
        <div class="lang-btn" onclick="selLang(this)">üá™üá∏ Espa√±ol</div>
        <div class="lang-btn" onclick="selLang(this)">üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</div>
        <div class="lang-btn" onclick="selLang(this)">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</div>
        <div class="lang-btn" onclick="selLang(this)">üåê More‚Ä¶</div>
      </div>
      <div class="ob-toggle">
        <div><div class="ob-tl">üîí Keep it private</div><div class="ob-ts">No account, stays on your phone</div></div>
        <div class="toggle on" onclick="this.classList.toggle('on')"></div>
      </div>
      <div class="ob-toggle">
        <div><div class="ob-tl">‚òÅÔ∏è Backup my data</div><div class="ob-ts">Encrypted, only you can see it</div></div>
        <div class="toggle" onclick="this.classList.toggle('on')"></div>
      </div>
      <div class="promise-box">
        <strong>üõ°Ô∏è Our promise to you</strong>
        <span>No ads. No selling your data. No judgement. Delete everything anytime.</span>
      </div>

      <div class="name-input-wrap">
        <div class="name-input-label">üå∏ What shall we call you?</div>
        <input class="name-input" id="ob-name-input" type="text" maxlength="20" placeholder="Your name or nickname‚Ä¶" oninput="previewName(this.value)">
        <div class="name-input-hint" id="name-hint">This is just for you ‚Äî shows on your home screen üíï</div>
      </div>

      <button class="ob-btn" onclick="saveNameAndGo()">Begin your journey üå∏</button>
    </div>
  </div>

  <!-- ‚ïê‚ïê MODE SELECTION ‚ïê‚ïê -->
  <div id="s-mode" class="screen" style="padding:0">
    <div class="mode-screen">
      <div style="font-size:2.8rem;margin-bottom:10px">üå∏</div>
      <div class="mode-h">What are you<br><em>tracking?</em></div>
      <div class="mode-p">Choose your journey ‚Äî you can switch anytime<br>from your home screen. üíï</div>
      <div class="mode-cards">
        <div class="mcard mcard-period" onclick="selectMode('period')">
          <div class="mc-em">ü©∏</div>
          <div class="mc-txt">
            <div class="mc-title">Track my Period</div>
            <div class="mc-desc">Predict your cycle, understand phases, log symptoms &amp; mood</div>
          </div>
          <div class="mc-arr">‚Üí</div>
        </div>
        <div class="mcard mcard-preg" onclick="selectMode('preg')">
          <div class="mc-em">ü§∞</div>
          <div class="mc-txt">
            <div class="mc-title">Track my Pregnancy</div>
            <div class="mc-desc">Week-by-week progress, baby growth, kick counter &amp; appointments</div>
          </div>
          <div class="mc-arr">‚Üí</div>
        </div>
        <div class="mcard mcard-ovul" onclick="selectMode('ovul')">
          <div class="mc-em">üåø</div>
          <div class="mc-txt">
            <div class="mc-title">Track Ovulation</div>
            <div class="mc-desc">Find your fertile window, BBT tracking, TTC &amp; family planning</div>
          </div>
          <div class="mc-arr">‚Üí</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê JOURNEY WIZARD ‚ïê‚ïê -->
  <div id="s-journey" class="screen" style="padding:0">
    <div class="jrn-screen">
      <div class="jrn-header">
        <div class="jrn-back" onclick="jrnBack()">‚Üê</div>
        <div class="jrn-prog-wrap">
          <div class="jrn-prog-bar-bg"><div class="jrn-prog-bar" id="jrn-bar" style="width:20%"></div></div>
          <div class="jrn-step-txt" id="jrn-step-txt">Step 1 of 5</div>
        </div>
      </div>
      <div class="jrn-body" id="jrn-body"></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê HOME ‚ïê‚ïê -->
  <div id="s-home" class="screen">
    <div class="scr-pad" id="home-content"></div>
  </div>

  <!-- ‚ïê‚ïê LOG ‚ïê‚ïê -->
  <div id="s-log" class="screen">
    <div class="scr-pad" id="log-content"></div>
  </div>

  <!-- ‚ïê‚ïê INSIGHTS ‚ïê‚ïê -->
  <div id="s-insights" class="screen">
    <div class="scr-pad" id="insights-content"></div>
  </div>

  <!-- ‚ïê‚ïê LEARN ‚ïê‚ïê -->
  <div id="s-learn" class="screen">
    <div class="scr-pad" id="learn-content"></div>
  </div>

  <!-- ‚ïê‚ïê SELF-CARE ‚ïê‚ïê -->
  <div id="s-care" class="screen">
    <div class="scr-pad" id="care-content"></div>
  </div>

  <!-- ‚ïê‚ïê RITUAL SESSION OVERLAY ‚ïê‚ïê -->
  <div id="ritual-overlay" class="ritual-overlay" style="display:none">
    <div class="ro-header">
      <button class="ro-close" id="ro-close-btn" onclick="closeRitual()">‚úï</button>
      <div class="ro-title" id="ro-title">Today's Ritual</div>
      <div class="ro-step-lbl" id="ro-step-lbl">1 of 4</div>
    </div>
    <div class="ro-progress-bar-bg" id="ro-prog-bg">
      <div class="ro-progress-bar" id="ro-prog-bar" style="width:25%"></div>
    </div>
    <div class="ro-body" id="ro-body"></div>
    <div class="ro-footer" id="ro-footer">
      <button class="ro-btn-skip" onclick="ritualSkip()">Skip ‚Üí</button>
      <button class="ro-btn-next" id="ro-next-btn" onclick="ritualNext()">Start timer ‚ñ∂</button>
    </div>
  </div>

  <!-- BOTTOM NAV (4 items + center +) -->
  <div class="nav" id="main-nav" style="display:none">
    <div class="nav-item" id="ni-home"     onclick="go('home')"    ><span>üè†</span>Home</div>
    <div class="nav-item" id="ni-insights" onclick="go('insights')"><span>‚ú®</span>Insights</div>
    <div class="nav-plus-slot"><div class="nav-plus-btn" id="nav-plus" onclick="go('log')">+</div></div>
    <div class="nav-item" id="ni-learn"    onclick="go('learn')"   ><span>üìñ</span>Learn</div>
    <div class="nav-item" id="ni-care"     onclick="go('care')"    ><span>üåø</span>Care</div>
  </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let currentMode = 'period'; // period | preg | ovul
let jrnMode = 'period', jrnStep = 0, jrnData = {};
let kicks = 0;
let userName = '';

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SPLASH ‚Üí LET'S GO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
window.addEventListener('DOMContentLoaded', () => {
  const sp = document.getElementById('s-splash');
  setTimeout(() => {
    sp.classList.add('hiding');
    sp.addEventListener('animationend', () => {
      sp.style.display = 'none';
      document.getElementById('s-ob').classList.add('active');
    }, { once:true });
  }, 3200);
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   NAVIGATION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const ALL_SCREENS = ['ob','mode','journey','home','log','insights','learn','care'];
const APP_SCREENS  = ['home','log','insights','learn','care'];
const NAV_MAP = { home:'ni-home', insights:'ni-insights', learn:'ni-learn', care:'ni-care' };
const NAV_COLOR = {
  period: 'on',
  preg:   'on-bl',
  ovul:   'on-gr'
};

function saveNameAndGo() {
  const input = document.getElementById('ob-name-input');
  userName = (input ? input.value.trim() : '') || 'lovely';
  go('mode');
}

function previewName(val) {
  const hint = document.getElementById('name-hint');
  if(!hint) return;
  if(val.trim().length > 0) {
    hint.textContent = `Hi ${val.trim()}! üëã Looking great üå∏`;
    hint.classList.add('ready');
  } else {
    hint.textContent = `This is just for you ‚Äî shows on your home screen üíï`;
    hint.classList.remove('ready');
  }
}


function go(name) {
  ALL_SCREENS.forEach(id => {
    const el = document.getElementById('s-'+id);
    if(el) el.classList.remove('active');
  });
  const t = document.getElementById('s-'+name);
  if(t) t.classList.add('active');

  const nav = document.getElementById('main-nav');
  const isApp = APP_SCREENS.includes(name) || name === 'log';
  nav.style.display = isApp ? 'flex' : 'none';

  // Update + button color based on mode
  const plusBtn = document.getElementById('nav-plus');
  if(plusBtn) {
    plusBtn.className = 'nav-plus-btn' + (currentMode==='preg' ? ' bl' : currentMode==='ovul' ? ' gr' : '');
  }

  if(isApp) {
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('on','on-bl','on-gr'));
    const ni = document.getElementById(NAV_MAP[name]);
    if(ni) ni.classList.add(NAV_COLOR[currentMode]||'on');
    renderModeContent(name);
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODE SELECTION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function selectMode(mode) {
  jrnMode = mode;
  jrnStep = 0;
  jrnData = {};
  kicks = 0;
  renderJourneyStep();
  go('journey');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   JOURNEY WIZARD
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const JOURNEYS = {
  period: [
    { icon:'ü©∏', col:'',
      q:'When did your <em>last period</em> start?',
      sub:'This helps us predict your next period and fertile window accurately.',
      type:'date', key:'lastPeriod', skip:'Not sure / this is my first time tracking' },
    { icon:'üìÖ', col:'',
      q:'How long is your cycle <em>usually?</em>',
      sub:'Day 1 of one period to Day 1 of the next. Most cycles are 21‚Äì35 days.',
      type:'stepper', key:'cycleLen', min:18, max:45, def:28, unit:'days', skip:'Not sure yet ‚Äî we\'ll learn!' },
    { icon:'üóìÔ∏è', col:'',
      q:'How many days does your <em>period last?</em>',
      sub:'Include light spotting days. Most periods last 3‚Äì7 days.',
      type:'stepper', key:'periodLen', min:1, max:10, def:5, unit:'days' },
    { icon:'üíß', col:'',
      q:'How would you describe your <em>usual flow?</em>',
      sub:'Helps us give you better predictions and product recommendations.',
      type:'chips-single', key:'flow',
      opts:[{e:'üíß',l:'Light',v:'light'},{e:'üü†',l:'Medium',v:'medium'},{e:'üî¥',l:'Heavy',v:'heavy'},{e:'üîÄ',l:'Varies',v:'varies'}] },
    { icon:'üåÄ', col:'',
      q:'Symptoms you <em>often get?</em>',
      sub:'Select all that apply ‚Äî we\'ll personalise your care tips each phase.',
      type:'chips-multi', key:'symptoms',
      opts:[{e:'üåÄ',l:'Cramps'},{e:'ü§ï',l:'Headache'},{e:'üò¥',l:'Fatigue'},{e:'ü§¢',l:'Nausea'},{e:'üåä',l:'Bloating'},{e:'üíÜ',l:'Back Pain'},{e:'üç´',l:'Cravings'},{e:'üò§',l:'Mood Swings'},{e:'üå°Ô∏è',l:'Breast Tenderness'},{e:'‚ú®',l:'None usually'}] }
  ],
  preg: [
    { icon:'ü§∞', col:'bl',
      q:'<span class="cl-bl">Are you currently pregnant?</span>',
      sub:'This helps us set up the right tracker for you. No judgement either way.',
      type:'chips-big-single', key:'isPreg',
      opts:[{e:'‚úÖ',l:'Yes, I\'m pregnant!',v:'yes'},{e:'ü§î',l:'I think I might be',v:'maybe'},{e:'üîÑ',l:'Actually, I\'m not ‚Äî switch tracker',v:'switch',special:true}],
      warn:'You can switch back to Period or Ovulation tracker anytime from your home screen.' },
    { icon:'üìÖ', col:'bl',
      q:'Do you know your <span class="cl-bl">due date?</span>',
      sub:'If yes, enter it. If not, enter your last period start date and we\'ll calculate.',
      type:'due-date', key:'dueDate' },
    { icon:'üë∂', col:'bl',
      q:'Is this your <span class="cl-bl">first pregnancy?</span>',
      sub:'This personalises your week-by-week tips and what to expect.',
      type:'chips-big-single', key:'firstPreg',
      opts:[{e:'üå±',l:'Yes ‚Äî my first!',v:'first'},{e:'üëß',l:'I have one child',v:'second'},{e:'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',l:'Two or more children',v:'multiple'}] },
    { icon:'ü©∫', col:'bl',
      q:'Any conditions to <span class="cl-bl">track together?</span>',
      sub:'Optional ‚Äî select any for extra personalised support and reminders.',
      type:'chips-multi', key:'conditions',
      opts:[{e:'ü©∫',l:'Gestational Diabetes'},{e:'üíì',l:'High Blood Pressure'},{e:'ü§¢',l:'Severe Morning Sickness'},{e:'ü©∏',l:'Anaemia'},{e:'üß†',l:'Prenatal Anxiety'},{e:'üò¥',l:'Sleep Issues'},{e:'‚ú®',l:'All good ‚Äî none'}] },
    { icon:'üíô', col:'bl',
      q:'What support do you <span class="cl-bl">want from us?</span>',
      sub:'We\'ll send you the content that matters most. Adjust anytime.',
      type:'chips-multi', key:'support',
      opts:[{e:'üìã',l:'Weekly baby updates'},{e:'ü©∫',l:'Appointment reminders'},{e:'üë∂',l:'Kick counter alerts'},{e:'üåø',l:'Nutrition & wellness tips'},{e:'üßò',l:'Mental health & mindfulness'},{e:'üìñ',l:'Birth & newborn prep'}] }
  ],
  ovul: [
    { icon:'üåø', col:'gr',
      q:'What\'s your <span class="cl-gr">main goal?</span>',
      sub:'This shapes your insights, alerts, and what tools we highlight for you.',
      type:'chips-big-single', key:'goal',
      opts:[{e:'üë∂',l:'Trying to conceive (TTC)',v:'ttc'},{e:'üåø',l:'Natural family planning',v:'nfp'},{e:'üî¨',l:'Understanding my body & cycle',v:'understand'}] },
    { icon:'üìÖ', col:'gr',
      q:'When did your <span class="cl-gr">last period start?</span>',
      sub:'We calculate your fertile window from this. Ovulation is usually ~14 days before your next period.',
      type:'date', key:'lastPeriod', skip:'Skip for now' },
    { icon:'üîÅ', col:'gr',
      q:'How long is your cycle <span class="cl-gr">usually?</span>',
      sub:'Knowing this makes ovulation predictions much more accurate.',
      type:'stepper', key:'cycleLen', min:18, max:45, def:28, unit:'days', skip:'Not sure yet' },
    { icon:'üå°Ô∏è', col:'gr',
      q:'What do you currently <span class="cl-gr">track?</span>',
      sub:'Select all that apply ‚Äî we\'ll guide you on using each method together.',
      type:'chips-multi', key:'methods',
      opts:[{e:'üå°Ô∏è',l:'BBT (Basal Body Temp)'},{e:'üíä',l:'OPK / LH Test Strips'},{e:'üíß',l:'Cervical Mucus'},{e:'üìÖ',l:'Period dates only'},{e:'ü©∏',l:'Mid-cycle spotting'},{e:'üÜï',l:'Nothing yet ‚Äî just starting!'}] },
    { icon:'üîî', col:'gr',
      q:'How should we <span class="cl-gr">alert you?</span>',
      sub:'We only send what you choose. You can change this anytime.',
      type:'chips-multi', key:'alerts',
      opts:[{e:'üü¢',l:'Fertile window opens'},{e:'üéØ',l:'Peak ovulation day'},{e:'üìâ',l:'Fertile window closing'},{e:'üìÖ',l:'Period due reminder'},{e:'üå°Ô∏è',l:'BBT reminder each morning'},{e:'üíä',l:'OPK test reminder'}] }
  ]
};

function renderJourneyStep() {
  const steps = JOURNEYS[jrnMode];
  const step  = steps[jrnStep];
  const total = steps.length;
  const pct   = Math.round(((jrnStep+1)/total)*100);
  const col   = step.col || '';

  document.getElementById('jrn-bar').style.width = pct+'%';
  document.getElementById('jrn-bar').className = 'jrn-prog-bar' + (col ? ' '+col : '');
  document.getElementById('jrn-step-txt').textContent = 'Step '+(jrnStep+1)+' of '+total;

  const isLast = jrnStep === total-1;
  const btnLbl = isLast ? 'Done! Let\'s go ‚Üí' : 'Continue ‚Üí';
  const btnCls = 'jrn-btn' + (col ? ' '+col : '');

  let html = `<div class="jrn-icon">${step.icon}</div>
<div class="jrn-q">${step.q}</div>
<div class="jrn-sub">${step.sub}</div>`;

  if(step.warn) html += `<div class="jrn-warn">üí° ${step.warn}</div>`;

  if(step.type === 'date') {
    html += `<input type="date" class="jdate ${col}" id="jrn-inp" value="${jrnData[step.key]||''}">`;
    if(step.skip) html += `<span class="skip-link" onclick="jrnNext(true)">${step.skip}</span>`;
  }
  else if(step.type === 'stepper') {
    const val = jrnData[step.key] || step.def;
    html += `<div class="jstepper">
  <div class="jst-left"><div class="jst-lbl">${step.unit}</div><div class="jst-val ${col}" id="jst-val">${val}</div></div>
  <div class="jst-btns">
    <button class="jstb ${col||'pk'}" onclick="jstAdj(-1,${step.min},${step.max})">‚àí</button>
    <button class="jstb ${col||'pk'}" onclick="jstAdj(1,${step.min},${step.max})">+</button>
  </div>
</div>`;
    if(step.skip) html += `<span class="skip-link" onclick="jrnNext(true)">${step.skip}</span>`;
  }
  else if(step.type === 'chips-single') {
    html += `<div class="jchips" id="jchips">`;
    step.opts.forEach(o => {
      const sel = jrnData[step.key] === o.v ? ` on${col?'-'+col:''}` : '';
      html += `<div class="jchip${sel}" onclick="jChipSingle(this,'${step.key}','${o.v}')">${o.e} ${o.l}</div>`;
    });
    html += `</div>`;
  }
  else if(step.type === 'chips-big-single') {
    html += `<div class="jchips" id="jchips" style="flex-direction:column">`;
    step.opts.forEach(o => {
      const sel = jrnData[step.key] === o.v ? ` on${col?'-'+col:''}` : '';
      if(o.special) {
        html += `<div class="jchip jchip-big${sel}" onclick="go('mode')">${o.e} ${o.l}</div>`;
      } else {
        html += `<div class="jchip jchip-big${sel}" onclick="jChipBigSingle(this,'${step.key}','${o.v}')">${o.e} ${o.l}</div>`;
      }
    });
    html += `</div>`;
  }
  else if(step.type === 'chips-multi') {
    const sel = jrnData[step.key] || [];
    html += `<div class="jchips" id="jchips">`;
    step.opts.forEach(o => {
      const on = sel.includes(o.l) ? ` on${col?'-'+col:''}` : '';
      html += `<div class="jchip${on}" onclick="jChipMulti(this,'${step.key}','${o.l}','${col}')">${o.e} ${o.l}</div>`;
    });
    html += `</div>`;
  }
  else if(step.type === 'due-date') {
    html += `<div class="jchips" id="due-toggle" style="flex-direction:column;margin-bottom:10px">
  <div class="jchip jchip-big ${jrnData.dueDateKnown!==false?'on-bl':''}" onclick="setDueDateMode(true)">üìÖ Yes, I know my due date</div>
  <div class="jchip jchip-big ${jrnData.dueDateKnown===false?'on-bl':''}" onclick="setDueDateMode(false)">ü©∏ Use my last period start instead</div>
</div>
<input type="date" class="jdate bl" id="jrn-inp" value="${jrnData[step.key]||''}">`;
  }

  html += `<button class="${btnCls}" onclick="jrnNext(false)">${btnLbl}</button>`;
  document.getElementById('jrn-body').innerHTML = html;
  document.querySelector('.jrn-screen').scrollTop = 0;
}

function jrnBack() {
  if(jrnStep > 0) { jrnStep--; renderJourneyStep(); }
  else go('mode');
}

function jrnNext(skip) {
  const steps = JOURNEYS[jrnMode];
  const step  = steps[jrnStep];
  if(!skip) {
    if(step.type === 'date' || step.type === 'due-date') {
      const inp = document.getElementById('jrn-inp');
      if(inp) jrnData[step.key] = inp.value;
    } else if(step.type === 'stepper') {
      const v = document.getElementById('jst-val');
      if(v) jrnData[step.key] = parseInt(v.textContent);
    }
  }
  if(jrnStep < steps.length-1) { jrnStep++; renderJourneyStep(); }
  else {
    currentMode = jrnMode;
    go('home');
  }
}

function jstAdj(d, mn, mx) {
  const el = document.getElementById('jst-val');
  if(el) el.textContent = Math.min(mx, Math.max(mn, parseInt(el.textContent)+d));
}
function jChipSingle(el, key, val) {
  el.closest('.jchips').querySelectorAll('.jchip').forEach(c=>c.classList.remove('on','on-bl','on-gr'));
  el.classList.add('on');
  jrnData[key] = val;
}
function jChipBigSingle(el, key, val) {
  const col = JOURNEYS[jrnMode][jrnStep].col;
  el.closest('.jchips').querySelectorAll('.jchip').forEach(c=>c.classList.remove('on','on-bl','on-gr'));
  el.classList.add(col ? 'on-'+col : 'on');
  jrnData[key] = val;
  setTimeout(() => jrnNext(false), 260);
}
function jChipMulti(el, key, label, col) {
  const cls = col ? 'on-'+col : 'on';
  if(!jrnData[key]) jrnData[key] = [];
  if(el.classList.contains(cls)) { el.classList.remove(cls); jrnData[key]=jrnData[key].filter(v=>v!==label); }
  else { el.classList.add(cls); jrnData[key].push(label); }
}
function setDueDateMode(known) {
  jrnData.dueDateKnown = known;
  document.querySelectorAll('#due-toggle .jchip').forEach((b,i)=>{
    b.classList.remove('on-bl');
    if(i===(known?0:1)) b.classList.add('on-bl');
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RENDER MODE CONTENT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderModeContent(screen) {
  const el = document.getElementById(screen+'-content');
  if(!el) return;
  if(screen==='home')     el.innerHTML = buildHome();
  if(screen==='log')      el.innerHTML = buildLog();
  if(screen==='insights') el.innerHTML = buildInsights();
  if(screen==='learn')    el.innerHTML = buildLearn();
  if(screen==='care')     el.innerHTML = buildCare();
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ HOME ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function buildHome() {
  if(currentMode==='period') return `
<div class="greeting">Good morning ‚òÄÔ∏è</div>
<div class="name">${userName} üëã</div>
<div class="circle-wrap">
  <div class="cycle-circle">
    <div class="day-num">14</div>
    <div class="day-label">Cycle Day</div>
    <div class="phase-label">Fertile Window üåø</div>
  </div>
</div>
<div class="pills-row">
  <div class="pill"><div class="pill-val">28</div><div class="pill-lbl">Avg Cycle</div></div>
  <div class="pill"><div class="pill-val" style="color:#c9a0d0">5</div><div class="pill-lbl">Period Days</div></div>
  <div class="pill"><div class="pill-val" style="color:#8ab88a">12</div><div class="pill-lbl">Logged</div></div>
</div>
<div class="cal-title">February 2026 üóìÔ∏è</div>
<div class="cal">
  <div class="ch">Su</div><div class="ch">Mo</div><div class="ch">Tu</div><div class="ch">We</div><div class="ch">Th</div><div class="ch">Fr</div><div class="ch">Sa</div>
  <div class="cd e"></div><div class="cd e"></div><div class="cd e"></div><div class="cd e"></div><div class="cd e"></div><div class="cd e"></div><div class="cd">1</div>
  <div class="cd p">2</div><div class="cd p">3</div><div class="cd p">4</div><div class="cd p">5</div><div class="cd p">6</div><div class="cd">7</div><div class="cd">8</div>
  <div class="cd">9</div><div class="cd f">10</div><div class="cd f">11</div><div class="cd f">12</div><div class="cd f">13</div><div class="cd t">14</div><div class="cd f">15</div>
  <div class="cd">16</div><div class="cd">17</div><div class="cd">18</div><div class="cd">19</div><div class="cd">20</div><div class="cd">21</div><div class="cd">22</div>
  <div class="cd">23</div><div class="cd">24</div><div class="cd">25</div><div class="cd">26</div><div class="cd">27</div><div class="cd">28</div><div class="cd e"></div>
</div>
<div style="display:flex;gap:10px;margin-top:8px;font-size:0.62rem;font-weight:700;color:#d0b0b8">
  <span>üî¥ Period</span><span style="margin-left:4px">üü¢ Fertile</span><span style="margin-left:4px">‚óâ Today</span>
</div>
<div class="next-banner">
  <div><div class="nb-lbl">Next Period</div><div class="nb-val">March 6 ü©∏</div><div class="nb-sub">In 14 days ¬∑ 85% confident</div></div>
  <div class="nb-ring"><svg width="50" height="50" viewBox="0 0 50 50"><circle cx="25" cy="25" r="19" fill="none" stroke="#fce8e4" stroke-width="5"/><circle cx="25" cy="25" r="19" fill="none" stroke="#d97b8a" stroke-width="5" stroke-dasharray="119" stroke-dashoffset="18" stroke-linecap="round"/></svg><div class="nb-pct">85%</div></div>
</div>
${switchModeCard()}`;

  if(currentMode==='preg') return `
<div class="greeting">Good morning ‚òÄÔ∏è</div>
<div class="name">${userName} üëã</div>
<div class="circle-wrap">
  <div class="cycle-circle bl">
    <div class="day-num bl">24</div>
    <div class="day-label bl">Weeks</div>
    <div class="phase-label bl">2nd Trimester üíô</div>
  </div>
</div>
<div class="pills-row">
  <div class="pill"><div class="pill-val bl" style="color:#4a70b0">113</div><div class="pill-lbl">Days to Go</div></div>
  <div class="pill"><div class="pill-val" style="color:#9870c0">Jun 5</div><div class="pill-lbl">Due Date</div></div>
  <div class="pill"><div class="pill-val" style="color:#8ab88a">28</div><div class="pill-lbl">Logs</div></div>
</div>
<div class="baby-card">
  <div class="bc-week">Week 24 ‚Ä¢ What's happening</div>
  <div class="bc-size">üåΩ</div>
  <div class="bc-title">Baby is the size of a corn cob!</div>
  <div class="bc-sub">About 30cm and 600g. Baby's face is fully formed and she's practising breathing movements this week. Her brain is growing rapidly üíô</div>
</div>
<div class="next-banner bl">
  <div><div class="nb-lbl bl">Next Appointment</div><div class="nb-val">Mar 3 ü©∫</div><div class="nb-sub">28-week glucose screen</div></div>
  <div style="font-size:2rem">üóìÔ∏è</div>
</div>
${switchModeCard()}`;

  if(currentMode==='ovul') return `
<div class="greeting">Good morning ‚òÄÔ∏è</div>
<div class="name">${userName} üëã</div>
<div class="circle-wrap">
  <div class="cycle-circle gr">
    <div class="day-num gr">14</div>
    <div class="day-label gr">Cycle Day</div>
    <div class="phase-label gr">üéØ Peak Fertile</div>
  </div>
</div>
<div class="pills-row">
  <div class="pill"><div class="pill-val gr" style="color:#5a8e6a">Today</div><div class="pill-lbl">Ovulation</div></div>
  <div class="pill"><div class="pill-val" style="color:#d97b8a">Mar 6</div><div class="pill-lbl">Next Period</div></div>
  <div class="pill"><div class="pill-val" style="color:#8ab88a">28</div><div class="pill-lbl">Cycle Len</div></div>
</div>
<div class="fertile-bar-wrap">
  <div class="fb-title">üü¢ Fertile Window ‚Äî Day 10 to 16</div>
  <div class="fb-track"><div class="fb-fill" style="width:72%"></div></div>
  <div class="fb-labels"><span>Day 10</span><span>Peak (Day 14)</span><span>Day 16</span></div>
</div>
<div class="next-banner gr">
  <div><div class="nb-lbl gr">Ovulation Prediction</div><div class="nb-val">Today, Feb 21 üéØ</div><div class="nb-sub">89% confidence ¬∑ Log BBT to confirm</div></div>
  <div class="nb-ring"><svg width="50" height="50" viewBox="0 0 50 50"><circle cx="25" cy="25" r="19" fill="none" stroke="#d0e8d8" stroke-width="5"/><circle cx="25" cy="25" r="19" fill="none" stroke="#5a8e6a" stroke-width="5" stroke-dasharray="119" stroke-dashoffset="14" stroke-linecap="round"/></svg><div class="nb-pct gr">89%</div></div>
</div>
${switchModeCard()}`;
}

function switchModeCard() {
  if(currentMode==='period') return `
<div class="switch-mode-card">
  <div class="sm-title">Switch tracker</div>
  <button class="sm-btn" onclick="selectMode('preg')">ü§∞ Expecting? ‚Üí Track Pregnancy</button>
  <button class="sm-btn" onclick="selectMode('ovul')">üåø Trying to conceive? ‚Üí Track Ovulation</button>
</div>`;
  if(currentMode==='preg') return `
<div class="switch-mode-card">
  <div class="sm-title">Switch tracker</div>
  <button class="sm-btn urgent" onclick="selectMode('period')">‚ö†Ô∏è Selected pregnancy by mistake? ‚Üí Period Tracker</button>
  <button class="sm-btn" onclick="selectMode('ovul')">üåø Not pregnant yet? ‚Üí Ovulation Tracker</button>
</div>`;
  if(currentMode==='ovul') return `
<div class="switch-mode-card">
  <div class="sm-title">Switch tracker</div>
  <button class="sm-btn" onclick="selectMode('preg')">üéâ Got a positive test? ‚Üí Pregnancy Tracker</button>
  <button class="sm-btn" onclick="selectMode('period')">ü©∏ Just track my period ‚Üí Period Tracker</button>
</div>`;
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ LOG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function buildLog() {
  if(currentMode==='period') return `
<div class="page-title">How are you? üå∏</div>
<div class="page-sub">Thursday ¬∑ Feb 21, 2026</div>
<div class="section">Flow today?</div>
<div class="flow-row">
  <div class="flow-btn" onclick="sel(this,'.flow-btn')"><div class="flow-icon">üî¥</div><div class="flow-lbl">Heavy</div></div>
  <div class="flow-btn on" onclick="sel(this,'.flow-btn')"><div class="flow-icon">üü†</div><div class="flow-lbl">Medium</div></div>
  <div class="flow-btn" onclick="sel(this,'.flow-btn')"><div class="flow-icon">üü°</div><div class="flow-lbl">Light</div></div>
  <div class="flow-btn" onclick="sel(this,'.flow-btn')"><div class="flow-icon">ü§ç</div><div class="flow-lbl">None</div></div>
</div>
<div class="section">Mood?</div>
<div class="mood-row">
  <div class="mood-btn on" onclick="sel(this,'.mood-btn')">üòî</div>
  <div class="mood-btn" onclick="sel(this,'.mood-btn')">üòê</div>
  <div class="mood-btn" onclick="sel(this,'.mood-btn')">üôÇ</div>
  <div class="mood-btn" onclick="sel(this,'.mood-btn')">üòä</div>
  <div class="mood-btn" onclick="sel(this,'.mood-btn')">ü•∞</div>
</div>
<div class="section">Physical symptoms?</div>
<div class="chips">
  <div class="chip on" onclick="this.classList.toggle('on')">üåÄ Cramps</div>
  <div class="chip on" onclick="this.classList.toggle('on')">ü§ï Headache</div>
  <div class="chip" onclick="this.classList.toggle('on')">üò¥ Fatigue</div>
  <div class="chip" onclick="this.classList.toggle('on')">ü§¢ Nausea</div>
  <div class="chip" onclick="this.classList.toggle('on')">üåä Bloating</div>
  <div class="chip" onclick="this.classList.toggle('on')">üíÜ Back Pain</div>
  <div class="chip" onclick="this.classList.toggle('on')">üç´ Cravings</div>
  <div class="chip" onclick="this.classList.toggle('on')">üò§ Mood Swings</div>
  <div class="chip" onclick="this.classList.toggle('on')">üå°Ô∏è Breast Tenderness</div>
  <div class="chip" onclick="this.classList.toggle('on')">‚úö More</div>
</div>
<div class="section">Wellness</div>
<div class="log-stepper-row">
  <div class="log-step"><div class="ls-lbl">üíß Water (glasses)</div><div class="ls-ctrl"><button class="lsb pk" onclick="adj(this,-1,0,15)">‚àí</button><span class="ls-val" style="color:#d97b8a">6</span><button class="lsb pk" onclick="adj(this,1,0,15)">+</button></div></div>
  <div class="log-step"><div class="ls-lbl">üåô Sleep (hrs)</div><div class="ls-ctrl"><button class="lsb pk" onclick="adj(this,-1,0,12)">‚àí</button><span class="ls-val" style="color:#d97b8a">7</span><button class="lsb pk" onclick="adj(this,1,0,12)">+</button></div></div>
</div>
<div class="section">Note to self üå∑</div>
<textarea class="note" placeholder="Just for you ‚Äî how are you really feeling?">Feeling a bit drained. Cramps are manageable today.</textarea>
<button class="save-btn">Save today's log ‚úì</button>`;

  if(currentMode==='preg') return `
<div class="page-title">Daily Log üíô</div>
<div class="page-sub">Week 24 ¬∑ Thursday, Feb 21</div>
<div class="kick-wrap">
  <div class="kick-label">üë∂ Kick Counter ‚Äî Today</div>
  <div class="kick-num" id="kick-num">0</div>
  <button class="kick-btn" onclick="doKick()">üë∂</button>
  <div style="font-size:0.68rem;color:#7090c0;font-weight:700;margin-top:10px">Tap when you feel baby move ‚Äî aim for 10 kicks in 2 hours</div>
</div>
<div class="section">How are you feeling?</div>
<div class="mood-row">
  <div class="mood-btn" onclick="sel(this,'.mood-btn')">üòî</div>
  <div class="mood-btn on" onclick="sel(this,'.mood-btn')">üòê</div>
  <div class="mood-btn" onclick="sel(this,'.mood-btn')">üôÇ</div>
  <div class="mood-btn" onclick="sel(this,'.mood-btn')">üòä</div>
  <div class="mood-btn" onclick="sel(this,'.mood-btn')">ü•∞</div>
</div>
<div class="section">Symptoms today?</div>
<div class="chips">
  <div class="chip on-bl" onclick="this.classList.toggle('on-bl')">ü§¢ Nausea</div>
  <div class="chip" onclick="this.classList.toggle('on-bl')">üî• Heartburn</div>
  <div class="chip on-bl" onclick="this.classList.toggle('on-bl')">üò¥ Fatigue</div>
  <div class="chip" onclick="this.classList.toggle('on-bl')">üíÜ Back Pain</div>
  <div class="chip" onclick="this.classList.toggle('on-bl')">ü¶µ Leg Cramps</div>
  <div class="chip" onclick="this.classList.toggle('on-bl')">üåä Swelling</div>
  <div class="chip" onclick="this.classList.toggle('on-bl')">üò∞ Anxiety</div>
  <div class="chip" onclick="this.classList.toggle('on-bl')">üò¥ Insomnia</div>
  <div class="chip" onclick="this.classList.toggle('on-bl')">ü§Ø Brain Fog</div>
  <div class="chip" onclick="this.classList.toggle('on-bl')">‚ú® Feeling great!</div>
</div>
<div class="section">Wellness</div>
<div class="log-stepper-row">
  <div class="log-step"><div class="ls-lbl">üíß Water (glasses)</div><div class="ls-ctrl"><button class="lsb bl" onclick="adj(this,-1,0,15)">‚àí</button><span class="ls-val bl">8</span><button class="lsb bl" onclick="adj(this,1,0,15)">+</button></div></div>
  <div class="log-step"><div class="ls-lbl">‚öñÔ∏è Weight (kg)</div><div class="ls-ctrl"><button class="lsb bl" onclick="adj(this,-1,50,120)">‚àí</button><span class="ls-val bl">64</span><button class="lsb bl" onclick="adj(this,1,50,120)">+</button></div></div>
</div>
<div class="section">Appointment notes ü©∫</div>
<textarea class="note" placeholder="Notes from your last visit, questions for next time‚Ä¶"></textarea>
<button class="save-btn save-btn-bl">Save today's log üíô</button>`;

  if(currentMode==='ovul') return `
<div class="page-title">Daily Log üåø</div>
<div class="page-sub">Cycle Day 14 ¬∑ Feb 21, 2026</div>
<div class="bbt-input-wrap">
  <div class="bbt-lbl">üå°Ô∏è Basal Body Temperature</div>
  <input class="bbt-inp" type="number" step="0.01" min="35" max="38.5" placeholder="36.70" value="36.72">
  <div class="bbt-unit">¬∞C ‚Äî taken immediately on waking, before getting up</div>
</div>
<div class="section">Cervical mucus?</div>
<div class="chips">
  <div class="chip" onclick="selChipSingle(this,'.cm-chip')">üèúÔ∏è Dry / None</div>
  <div class="chip cm-chip" onclick="selChipSingle(this,'.cm-chip')">üç¨ Sticky</div>
  <div class="chip cm-chip" onclick="selChipSingle(this,'.cm-chip')">ü•õ Creamy</div>
  <div class="chip cm-chip on-gr" onclick="selChipSingle(this,'.cm-chip')">üíß Watery</div>
  <div class="chip cm-chip" onclick="selChipSingle(this,'.cm-chip')">ü•ö Egg White (peak!)</div>
</div>
<div class="section">OPK Test result?</div>
<div class="chips">
  <div class="chip" onclick="selChipSingle(this,'.opk-chip')">‚¨ú Negative</div>
  <div class="chip opk-chip" onclick="selChipSingle(this,'.opk-chip')">üü° Low</div>
  <div class="chip opk-chip on-gr" onclick="selChipSingle(this,'.opk-chip')">üü† High</div>
  <div class="chip opk-chip" onclick="selChipSingle(this,'.opk-chip')">üéØ Peak!</div>
  <div class="chip opk-chip" onclick="selChipSingle(this,'.opk-chip')">‚è≠Ô∏è Didn't test</div>
</div>
<div class="section">Mood & energy?</div>
<div class="mood-row">
  <div class="mood-btn" onclick="sel(this,'.mood-btn')">üòî</div>
  <div class="mood-btn" onclick="sel(this,'.mood-btn')">üòê</div>
  <div class="mood-btn on" onclick="sel(this,'.mood-btn')">üôÇ</div>
  <div class="mood-btn" onclick="sel(this,'.mood-btn')">üòä</div>
  <div class="mood-btn" onclick="sel(this,'.mood-btn')">ü•∞</div>
</div>
<div class="section">Other symptoms?</div>
<div class="chips">
  <div class="chip" onclick="this.classList.toggle('on-gr')">ü©∏ Mid-cycle spotting</div>
  <div class="chip" onclick="this.classList.toggle('on-gr')">üí´ Ovulation pain (Mittelschmerz)</div>
  <div class="chip" onclick="this.classList.toggle('on-gr')">üåø High libido</div>
  <div class="chip" onclick="this.classList.toggle('on-gr')">üå°Ô∏è Feeling warm</div>
</div>
<div class="section">Note üå∑</div>
<textarea class="note" placeholder="Anything else worth noting today?"></textarea>
<button class="save-btn save-btn-gr">Save today's log üåø</button>`;
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ INSIGHTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function buildInsights() {
  if(currentMode==='period') return `
<div class="page-title">Your Story ‚ú®</div>
<div class="page-sub">6 months of data</div>
<div class="big-insight">
  <div class="bi-emoji">üåø</div>
  <div class="bi-title">You're beautifully regular!</div>
  <div class="bi-sub">Your cycles have stayed between 27‚Äì29 days for 6 months. Your AI model is 92% accurate for your body üíï</div>
</div>
<div class="insight-card">
  <div class="ic-head">üìä Cycle Length ‚Äî Last 6 Months</div>
  <div class="mini-chart">
    <div class="mc-bar" style="height:70%"></div>
    <div class="mc-bar" style="height:80%"></div>
    <div class="mc-bar" style="height:73%"></div>
    <div class="mc-bar hi" style="height:85%"></div>
    <div class="mc-bar" style="height:76%"></div>
    <div class="mc-bar" style="height:78%;opacity:0.7"></div>
  </div>
  <div class="mc-labels"><div class="mc-lbl">Sep</div><div class="mc-lbl">Oct</div><div class="mc-lbl">Nov</div><div class="mc-lbl">Dec</div><div class="mc-lbl">Jan</div><div class="mc-lbl">Feb</div></div>
</div>
<div class="insight-card">
  <div class="ic-head">üå∏ Most common symptoms</div>
  <div class="bar-row"><div class="bar-name">Cramps</div><div class="bar-track"><div class="bar-fill" style="width:80%;background:linear-gradient(90deg,#fdd0d0,#d97b8a)"></div></div><div class="bar-num">8√ó</div></div>
  <div class="bar-row"><div class="bar-name">Fatigue</div><div class="bar-track"><div class="bar-fill" style="width:58%;background:linear-gradient(90deg,#e0c8f0,#a880c8)"></div></div><div class="bar-num" style="color:#a880c8">6√ó</div></div>
  <div class="bar-row"><div class="bar-name">Headache</div><div class="bar-track"><div class="bar-fill" style="width:38%;background:linear-gradient(90deg,#c8e8d0,#6a9e7a)"></div></div><div class="bar-num" style="color:#6a9e7a">4√ó</div></div>
  <div class="bar-row"><div class="bar-name">Bloating</div><div class="bar-track"><div class="bar-fill" style="width:28%;background:linear-gradient(90deg,#c8d8f0,#5a80c0)"></div></div><div class="bar-num" style="color:#5a80c0">3√ó</div></div>
</div>
<div class="insight-card">
  <div class="ic-head">üîÆ What's coming up</div>
  <div class="upcoming-row ur-period"><span>ü©∏ Next period</span><span>Mar 6 ¬∑ 92%</span></div>
  <div class="upcoming-row ur-fertile"><span>üåø Fertile window</span><span>Feb 18‚Äì23</span></div>
  <div class="upcoming-row ur-ov"><span>‚óé Ovulation</span><span>Feb 21 (today!)</span></div>
</div>
<div class="insight-card">
  <div class="ic-head">üí≠ Mood by phase</div>
  <div class="bar-row"><div class="bar-name">Menstrual</div><div class="bar-track"><div class="bar-fill" style="width:30%;background:linear-gradient(90deg,#fdd0d0,#d97b8a)"></div></div><div class="bar-num">üòî</div></div>
  <div class="bar-row"><div class="bar-name">Follicular</div><div class="bar-track"><div class="bar-fill" style="width:90%;background:linear-gradient(90deg,#c8e8d0,#6a9e7a)"></div></div><div class="bar-num">ü•∞</div></div>
  <div class="bar-row"><div class="bar-name">Ovulation</div><div class="bar-track"><div class="bar-fill" style="width:85%;background:linear-gradient(90deg,#c8e8d0,#6a9e7a)"></div></div><div class="bar-num">üòä</div></div>
  <div class="bar-row"><div class="bar-name">Luteal</div><div class="bar-track"><div class="bar-fill" style="width:50%;background:linear-gradient(90deg,#e0c8f0,#a880c8)"></div></div><div class="bar-num">üòê</div></div>
</div>`;

  if(currentMode==='preg') return `
<div class="page-title">Your Journey üíô</div>
<div class="page-sub">Week 24 of 40</div>
<div class="big-insight bl">
  <div class="bi-emoji">üíô</div>
  <div class="bi-title">You're doing amazing!</div>
  <div class="bi-sub bl">Week 24 ‚Äî you've completed 60% of your pregnancy. Baby is developing beautifully and you've been consistent with logging üíï</div>
</div>
<div class="insight-card bl">
  <div class="ic-head">üìä Kick Count ‚Äî Last 7 Days</div>
  <div class="mini-chart">
    <div class="mc-bar bl" style="height:60%"></div>
    <div class="mc-bar bl" style="height:75%"></div>
    <div class="mc-bar bl" style="height:65%"></div>
    <div class="mc-bar bl hi" style="height:90%"></div>
    <div class="mc-bar bl" style="height:80%"></div>
    <div class="mc-bar bl" style="height:70%"></div>
    <div class="mc-bar bl hi" style="height:85%;opacity:0.8"></div>
  </div>
  <div class="mc-labels"><div class="mc-lbl">Sat</div><div class="mc-lbl">Sun</div><div class="mc-lbl">Mon</div><div class="mc-lbl">Tue</div><div class="mc-lbl">Wed</div><div class="mc-lbl">Thu</div><div class="mc-lbl">Fri</div></div>
</div>
<div class="insight-card bl">
  <div class="ic-head">‚öñÔ∏è Weight Gain Progress</div>
  <div class="bar-row"><div class="bar-name">Current</div><div class="bar-track bl"><div class="bar-fill" style="width:60%;background:linear-gradient(90deg,#c8d8f4,#4a70b0)"></div></div><div class="bar-num" style="color:#4a70b0">+7 kg</div></div>
  <div class="bar-row"><div class="bar-name">Recommended</div><div class="bar-track bl"><div class="bar-fill" style="width:68%;background:linear-gradient(90deg,#c8e8d0,#6a9e7a)"></div></div><div class="bar-num" style="color:#6a9e7a">+8 kg</div></div>
  <div style="font-size:0.68rem;color:#7090b0;font-weight:600;margin-top:8px">‚úÖ You're within the healthy range for week 24</div>
</div>
<div class="insight-card bl">
  <div class="ic-head">üóìÔ∏è Upcoming milestones</div>
  <div class="upcoming-row ur-appt"><span>ü©∫ Glucose screening</span><span>Mar 3</span></div>
  <div class="upcoming-row ur-appt"><span>üë∂ 3rd trimester begins</span><span>Week 28</span></div>
  <div class="upcoming-row ur-appt"><span>üè• Birth class starts</span><span>Mar 20</span></div>
  <div class="upcoming-row ur-appt"><span>üéÅ Due date</span><span>Jun 5</span></div>
</div>
<div class="insight-card bl">
  <div class="ic-head">üå°Ô∏è Common symptoms this trimester</div>
  <div class="bar-row"><div class="bar-name">Fatigue</div><div class="bar-track bl"><div class="bar-fill" style="width:72%;background:linear-gradient(90deg,#c8d8f4,#4a70b0)"></div></div><div class="bar-num" style="color:#4a70b0">9d</div></div>
  <div class="bar-row"><div class="bar-name">Back pain</div><div class="bar-track bl"><div class="bar-fill" style="width:55%;background:linear-gradient(90deg,#c8d8f4,#4a70b0)"></div></div><div class="bar-num" style="color:#4a70b0">7d</div></div>
  <div class="bar-row"><div class="bar-name">Heartburn</div><div class="bar-track bl"><div class="bar-fill" style="width:38%;background:linear-gradient(90deg,#c8d8f4,#4a70b0)"></div></div><div class="bar-num" style="color:#4a70b0">5d</div></div>
</div>`;

  if(currentMode==='ovul') return `
<div class="page-title">Your Fertility üåø</div>
<div class="page-sub">6 cycles tracked</div>
<div class="big-insight gr">
  <div class="bi-emoji">üéØ</div>
  <div class="bi-title">Ovulation confirmed today!</div>
  <div class="bi-sub gr">Your BBT rise + egg-white mucus + high OPK confirms ovulation on Day 14. Your pattern is very consistent ‚Äî 89% prediction accuracy üåø</div>
</div>
<div class="insight-card gr">
  <div class="ic-head">üå°Ô∏è BBT Chart ‚Äî Last 14 Days</div>
  <div class="bbt-chart-wrap">
    <div class="bbt-bar pre" style="height:30%"></div>
    <div class="bbt-bar pre" style="height:35%"></div>
    <div class="bbt-bar pre" style="height:32%"></div>
    <div class="bbt-bar pre" style="height:28%"></div>
    <div class="bbt-bar pre" style="height:33%"></div>
    <div class="bbt-bar" style="height:38%"></div>
    <div class="bbt-bar" style="height:42%"></div>
    <div class="bbt-bar" style="height:40%"></div>
    <div class="bbt-bar" style="height:45%"></div>
    <div class="bbt-bar" style="height:48%"></div>
    <div class="bbt-bar" style="height:46%"></div>
    <div class="bbt-bar" style="height:52%"></div>
    <div class="bbt-bar" style="height:55%"></div>
    <div class="bbt-bar peak" style="height:80%"></div>
    <div class="bbt-ov-line" style="right:8%"></div>
  </div>
  <div class="bbt-chart-lbl"><span>Day 1</span><span>Ovulation ‚Üë</span><span>Today</span></div>
</div>
<div class="insight-card gr">
  <div class="ic-head">üìä Fertile Window ‚Äî Last 6 Cycles</div>
  <div class="bar-row"><div class="bar-name">Oct</div><div class="bar-track gr"><div class="bar-fill" style="width:60%;background:linear-gradient(90deg,#c0e8d0,#5a8e6a)"></div></div><div class="bar-num" style="color:#5a8e6a">Day 13</div></div>
  <div class="bar-row"><div class="bar-name">Nov</div><div class="bar-track gr"><div class="bar-fill" style="width:65%;background:linear-gradient(90deg,#c0e8d0,#5a8e6a)"></div></div><div class="bar-num" style="color:#5a8e6a">Day 14</div></div>
  <div class="bar-row"><div class="bar-name">Dec</div><div class="bar-track gr"><div class="bar-fill" style="width:60%;background:linear-gradient(90deg,#c0e8d0,#5a8e6a)"></div></div><div class="bar-num" style="color:#5a8e6a">Day 13</div></div>
  <div class="bar-row"><div class="bar-name">Jan</div><div class="bar-track gr"><div class="bar-fill" style="width:65%;background:linear-gradient(90deg,#c0e8d0,#5a8e6a)"></div></div><div class="bar-num" style="color:#5a8e6a">Day 14</div></div>
  <div class="bar-row"><div class="bar-name">Feb</div><div class="bar-track gr"><div class="bar-fill" style="width:65%;background:linear-gradient(90deg,#c0e8d0,#5a8e6a)"></div></div><div class="bar-num" style="color:#5a8e6a">Day 14</div></div>
</div>
<div class="insight-card gr">
  <div class="ic-head">üîÆ Upcoming predictions</div>
  <div class="upcoming-row ur-fertile"><span>üü¢ Fertile window closes</span><span>Feb 23</span></div>
  <div class="upcoming-row ur-period"><span>ü©∏ Next period due</span><span>Mar 6</span></div>
  <div class="upcoming-row ur-fertile"><span>üåø Next fertile window</span><span>Mar 18‚Äì24</span></div>
  <div class="upcoming-row ur-ov"><span>‚óé Next ovulation</span><span>Mar 21</span></div>
</div>`;
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ LEARN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function buildLearn() {
  let cats, arts;
  if(currentMode==='period') {
    cats = [
      {l:'All',on:true},{l:'üå∏ Phases'},{l:'üíÜ Symptoms'},{l:'üßº Hygiene'},{l:'‚ùå Myths'},{l:'üè• Doctor'}
    ];
    arts = [
      {i:'üî¨',tag:'tag-g',tl:'Phases',art:'The 4 phases of your cycle ‚Äî what\'s actually happening',m:'5 min ¬∑ WHO Source'},
      {i:'üåø',tag:'tag-p',tl:'Symptoms',art:'Natural ways to ease period cramps',m:'4 min ¬∑ Evidence-based'},
      {i:'‚ùå',tag:'tag-m',tl:'Myths',art:'10 period myths ‚Äî completely debunked!',m:'6 min ¬∑ Global'},
      {i:'ü©∫',tag:'tag-d',tl:'Doctor',art:'When should you see a doctor about your period?',m:'3 min ¬∑ Medical Guide'},
      {i:'üí∞',tag:'tag-h',tl:'Hygiene',art:'Period products guide ‚Äî pads, cups, discs, underwear',m:'5 min ¬∑ Global'},
      {i:'üß†',tag:'tag-m',tl:'Mental Health',art:'PMS vs PMDD ‚Äî know the difference',m:'4 min ¬∑ Clinical'}
    ];
  } else if(currentMode==='preg') {
    cats = [
      {l:'All',on:true},{l:'üë∂ This Week'},{l:'ü•ó Nutrition'},{l:'üßò Mental Health'},{l:'üè• Birth Prep'},{l:'üëº Newborn'}
    ];
    arts = [
      {i:'üë∂',tag:'tag-b',tl:'This Week',art:'Week 24: What\'s developing in your baby right now',m:'5 min ¬∑ NHS'},
      {i:'ü•ó',tag:'tag-n',tl:'Nutrition',art:'Iron-rich foods every pregnant woman needs',m:'4 min ¬∑ Dietitian-reviewed'},
      {i:'üßò',tag:'tag-m',tl:'Mental Health',art:'Prenatal anxiety ‚Äî it\'s more common than you think',m:'6 min ¬∑ Clinical'},
      {i:'üè•',tag:'tag-b',tl:'Birth Prep',art:'What to pack in your hospital bag ‚Äî complete checklist',m:'5 min ¬∑ Guide'},
      {i:'üíä',tag:'tag-g',tl:'Nutrition',art:'Folic acid, Vitamin D & supplements in pregnancy',m:'4 min ¬∑ Medical'},
      {i:'üëº',tag:'tag-n',tl:'Newborn',art:'The first 24 hours after birth ‚Äî what to expect',m:'6 min ¬∑ Midwife-reviewed'}
    ];
  } else {
    cats = [
      {l:'All',on:true},{l:'üå°Ô∏è BBT'},{l:'üíä OPK'},{l:'üë∂ TTC Tips'},{l:'üî¨ PCOS'},{l:'üåø Natural'}
    ];
    arts = [
      {i:'üå°Ô∏è',tag:'tag-n',tl:'BBT',art:'How to take your basal body temperature correctly',m:'4 min ¬∑ Fertility Expert'},
      {i:'üíä',tag:'tag-g',tl:'OPK',art:'OPK strips ‚Äî how to read them and when to test',m:'5 min ¬∑ Clinical'},
      {i:'üíß',tag:'tag-b',tl:'TTC Tips',art:'Cervical mucus: your most underrated fertility sign',m:'4 min ¬∑ Evidence-based'},
      {i:'üë∂',tag:'tag-p',tl:'TTC Tips',art:'Best timing for conception ‚Äî the science explained',m:'5 min ¬∑ Research'},
      {i:'üî¨',tag:'tag-m',tl:'PCOS',art:'PCOS and ovulation ‚Äî can you still get pregnant?',m:'7 min ¬∑ Endocrinologist'},
      {i:'üåø',tag:'tag-n',tl:'Natural',art:'Seed cycling for hormone balance ‚Äî does it work?',m:'5 min ¬∑ Nutritionist'}
    ];
  }

  const onCls = currentMode==='preg' ? 'on-bl' : currentMode==='ovul' ? 'on-gr' : 'on';
  let html = `<div class="page-title">Learn üìñ</div>
<div class="page-sub">${currentMode==='period'?'Cycle & body wisdom':currentMode==='preg'?'Your pregnancy guide':'Fertility & ovulation'}</div>
<input class="search-box" type="text" placeholder="üîç Search articles‚Ä¶">
<div class="cat-scroll">`;
  cats.forEach(c => html += `<div class="cat-btn${c.on?' '+onCls:''}" onclick="selCat(this,'${onCls}')">${c.l}</div>`);
  html += `</div>`;
  arts.forEach(a => html += `<div class="article"><div class="art-icon">${a.i}</div><div><div class="art-tag ${a.tag}">${a.tl}</div><div class="art-title">${a.art}</div><div class="art-meta">${a.m}</div></div></div>`);
  html += `<div style="text-align:center;font-size:0.7rem;color:#d0b0b8;font-weight:700;padding:14px 0;border-top:1px solid #fce8e4;margin-top:4px">üåç Available in 30+ languages</div>`;
  return html;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HELPERS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ CARE PHASE DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const CARE_DATA = {
  period: [
    {
      tab:{e:'ü©∏',l:'Menstrual'},
      badge:'ü©∏ Days 1‚Äì5',
      hero:{e:'üõå', t:'Rest & Restore', d:'Your body is shedding. Honour it with deep rest, warmth, and nourishment. This is not laziness ‚Äî this is medicine.'},
      affKey:'Menstrual',
      rituals:[
        {e:'üõÅ',t:'Warm Castor Oil Compress',s:'Place on lower abdomen to ease cramping',dur:'15 min'},
        {e:'üç´',t:'Anti-Inflammatory Foods',s:'Dark chocolate, ginger tea, leafy greens',dur:'All day'},
        {e:'üßò',t:'Yin Yoga ‚Äî Supported Child\'s Pose',s:'Surrender, breathe, release',dur:'10 min'},
        {e:'üìì',t:'Letting Go Journal',s:'"What am I releasing this cycle?"',dur:'5 min'},
      ],
      mood:'üåßÔ∏è Low energy expected ‚Äî be gentle',
      food:'Iron-rich: lentils, spinach, dark chocolate üç´',
      avoid:'Avoid intense cardio, cold drinks & caffeine'
    },
    {
      tab:{e:'üå±',l:'Follicular'},
      badge:'üå± Days 6‚Äì13',
      hero:{e:'üßò', t:'Rise & Bloom', d:'Oestrogen is climbing. Your energy, creativity and social drive are building. The best time to start new things.'},
      affKey:'Follicular',
      rituals:[
        {e:'üßò',t:'Morning Yoga ‚Äî Sun Salutation',s:'Energise your body as oestrogen rises',dur:'8 min'},
        {e:'üíÜ',t:'Gua Sha Face Massage',s:'Lymphatic drainage & natural glow',dur:'5 min'},
        {e:'üèÉ',t:'Light Cardio or Dance',s:'Harness rising energy ‚Äî have fun!',dur:'20 min'},
        {e:'üìì',t:'Cycle Journal Prompt',s:'"What do I want to invite this cycle?"',dur:'5 min'},
      ],
      mood:'‚¨ÜÔ∏è Energy rising ‚Äî great for new goals',
      food:'Protein & complex carbs: eggs, oats, avocado ü•ë',
      avoid:'Don\'t overcommit ‚Äî energy hasn\'t peaked yet'
    },
    {
      tab:{e:'‚ú®',l:'Ovulatory'},
      badge:'‚ú® Days 14‚Äì16',
      hero:{e:'üåü', t:'Peak Power Day', d:'You\'re at your most magnetic. Oestrogen + testosterone are peaking ‚Äî socialise, create, and tackle your hardest tasks.'},
      affKey:'Ovulatory',
      rituals:[
        {e:'üí™',t:'HIIT or Strength Training',s:'Your pain tolerance is highest now ‚Äî go for it',dur:'30 min'},
        {e:'üå∏',t:'Self-Expression Ritual',s:'Wear something that makes you feel powerful',dur:'5 min'},
        {e:'üó£Ô∏è',t:'Important Conversations',s:'Your communication is at its peak today',dur:'Ongoing'},
        {e:'ü´ê',t:'Antioxidant Smoothie',s:'Berries, flaxseed & maca for hormone support',dur:'5 min'},
      ],
      mood:'‚ú® Peak energy & confidence ‚Äî shine!',
      food:'Antioxidants: berries, flaxseeds, leafy greens ü´ê',
      avoid:'Watch for ovulation pain (Mittelschmerz)'
    },
    {
      tab:{e:'üåô',l:'Luteal'},
      badge:'üåô Days 17‚Äì28',
      hero:{e:'üåô', t:'Wind Down & Nest', d:'Progesterone is rising. Your body is preparing. Cravings, mood dips and fatigue are normal ‚Äî meet them with kindness.'},
      affKey:'Luteal',
      rituals:[
        {e:'üßò',t:'Restorative Yoga ‚Äî Legs Up Wall',s:'Calms the nervous system, reduces bloating',dur:'12 min'},
        {e:'üåø',t:'Seed Cycling ‚Äî Sesame & Sunflower',s:'Day 15‚Äì28: progesterone-supporting seeds',dur:'2 min'},
        {e:'üìµ',t:'Digital Sunset at 9pm',s:'Blue light worsens PMS ‚Äî protect your sleep',dur:'Nightly'},
        {e:'ü´ñ',t:'Raspberry Leaf Tea',s:'Traditional uterine toner & cramp support',dur:'5 min'},
      ],
      mood:'üåä Moody waves ‚Äî journaling helps a lot',
      food:'Magnesium & B6: bananas, pumpkin seeds üéÉ',
      avoid:'Reduce salt, alcohol & processed sugar'
    }
  ],
  preg: [
    {
      tab:{e:'üíô',l:'1st Trim'},
      badge:'üíô Weeks 1‚Äì12',
      hero:{e:'üå±', t:'Early Days ‚Äî Rest First', d:'Your body is doing something extraordinary. Fatigue and nausea are signs of a healthy pregnancy. Rest guilt-free.'},
      affKey:'1stTrim',
      rituals:[
        {e:'ü´ö',t:'Ginger & Lemon Tea',s:'Sip throughout the day to ease morning sickness',dur:'All day', cl:'bl'},
        {e:'üíä',t:'Folic Acid & Prenatal Vitamins',s:'Critical for neural tube development in weeks 1‚Äì12',dur:'Daily', cl:'bl'},
        {e:'üõå',t:'Power Nap Permission Slip',s:'15‚Äì20 mins after lunch ‚Äî your body needs it',dur:'20 min', cl:'bl'},
        {e:'üìì',t:'Pregnancy Journal ‚Äî Week 1',s:'"The moment I found out‚Ä¶"',dur:'5 min', cl:'bl'},
      ],
      mood:'üò¥ Exhaustion is normal ‚Äî honour it',
      food:'Folic acid: dark leafy greens, fortified cereals ü•¨',
      avoid:'Avoid raw fish, unpasteurised cheese, alcohol'
    },
    {
      tab:{e:'üå∏',l:'2nd Trim'},
      badge:'üå∏ Weeks 13‚Äì26',
      hero:{e:'ü§∞', t:'Golden Trimester', d:'Energy is back and bump is showing. This is the ideal window for prenatal fitness, bonding rituals and birth preparation.'},
      affKey:'2ndTrim',
      rituals:[
        {e:'üßò',t:'Prenatal Yoga ‚Äî Hip Opener',s:'Safe stretches for your growing body',dur:'12 min', cl:'bl'},
        {e:'üå¨Ô∏è',t:'4-7-8 Breathing for Calm',s:'Reduce anxiety & improve sleep quality',dur:'5 min', cl:'bl'},
        {e:'üíÜ',t:'Belly Massage with Oils',s:'Rosehip or coconut oil to support skin elasticity',dur:'5 min', cl:'bl'},
        {e:'üìì',t:'Baby Letter Journal',s:'"Dear baby, today I felt‚Ä¶"',dur:'5 min', cl:'bl'},
      ],
      mood:'üå∏ Most women feel best in this trimester!',
      food:'Iron & calcium: lean meat, dairy, lentils ü•õ',
      avoid:'No hot baths, avoid lying flat on your back'
    },
    {
      tab:{e:'üåü',l:'3rd Trim'},
      badge:'üåü Weeks 27‚Äì40',
      hero:{e:'üéí', t:'Birth Prep Mode', d:'The final stretch. Focus on perineal prep, hospital bag, birth plan and mental readiness. You\'ve got this.'},
      affKey:'3rdTrim',
      rituals:[
        {e:'üíÜ',t:'Perineal Massage',s:'From week 34 ‚Äî reduces tearing risk during birth',dur:'5 min', cl:'bl'},
        {e:'üßò',t:'Pelvic Floor Exercises',s:'Kegels + deep core for birth prep',dur:'8 min', cl:'bl'},
        {e:'üéí',t:'Hospital Bag Checklist',s:'Pack by week 36 ‚Äî snacks, clothes, documents',dur:'20 min', cl:'bl'},
        {e:'üå¨Ô∏è',t:'Labour Breathing Practice',s:'J-breathing, surge breathing ‚Äî rehearse now',dur:'10 min', cl:'bl'},
      ],
      mood:'üò¨ Anxiety is normal ‚Äî talk it through',
      food:'Dates from week 36: may support labour onset üå¥',
      avoid:'Monitor for swelling, headaches, reduced movement'
    },
    {
      tab:{e:'üëº',l:'Postpartum'},
      badge:'üëº 4th Trimester',
      hero:{e:'üíï', t:'You Just Did That', d:'Recovery, feeding, sleep deprivation ‚Äî all at once. The 4th trimester is real. Rest, accept help, and be incredibly kind to yourself.'},
      affKey:'Postpartum',
      rituals:[
        {e:'üõÅ',t:'Sitz Bath',s:'Warm soak for perineal healing after vaginal birth',dur:'15 min', cl:'bl'},
        {e:'ü•ò',t:'Confinement Nourishing Meals',s:'Warm, cooked foods to restore qi & blood',dur:'All day', cl:'bl'},
        {e:'ü§±',t:'Skin-to-Skin Bonding',s:'Regulates baby\'s temp, heart rate & supports milk',dur:'Daily', cl:'bl'},
        {e:'üìã',t:'EPDS Mood Check-In',s:'Monitor for postnatal depression symptoms',dur:'5 min', cl:'bl'},
      ],
      mood:'üíô Baby blues peak at days 3‚Äì5 ‚Äî reach out',
      food:'Protein & galactagogues: oats, fenugreek, dates üåæ',
      avoid:'No heavy lifting for 6 weeks; rest between visitors'
    }
  ],
  ovul: [
    {
      tab:{e:'üìÖ',l:'Early'},
      badge:'üìÖ Days 1‚Äì7',
      hero:{e:'üîÑ', t:'Cycle Reset', d:'Your period just ended. Oestrogen is low but beginning to rise. This is your reset window ‚Äî build your foundation.'},
      affKey:'EarlyOvul',
      rituals:[
        {e:'üåø',t:'Seed Cycling ‚Äî Start Flax & Pumpkin',s:'Phase 1 seeds to support oestrogen production',dur:'Daily', cl:'gr'},
        {e:'üßò',t:'Gentle Restorative Yoga',s:'Replenish energy post-period with slow flows',dur:'15 min', cl:'gr'},
        {e:'ü•ó',t:'Iron-Rich Meals',s:'Replenish what was lost ‚Äî spinach, lentils, meat',dur:'All day', cl:'gr'},
        {e:'üìì',t:'TTC Tracker Setup',s:'Log last period, set ovulation prediction alert',dur:'5 min', cl:'gr'},
      ],
      mood:'üîÑ Fresh start energy ‚Äî great for planning',
      food:'Iron & zinc: red meat, pumpkin seeds, lentils üåø',
      avoid:'Give your uterus gentle movement, not intense cardio'
    },
    {
      tab:{e:'üå±',l:'Pre-Ovul'},
      badge:'üå± Days 8‚Äì13',
      hero:{e:'üåø', t:'Fertile Window Approaching', d:'Oestrogen is climbing and your fertile window is opening. Support cervical mucus, track signs and prepare your body.'},
      affKey:'PreOvul',
      rituals:[
        {e:'üßò',t:'Core & Hip Yoga Flow',s:'Boost blood flow to reproductive organs',dur:'10 min', cl:'gr'},
        {e:'üåø',t:'Seed Cycling ‚Äî Flax & Pumpkin',s:'Continue Phase 1 seeds through to ovulation',dur:'2 min', cl:'gr'},
        {e:'üå°Ô∏è',t:'BBT Charting',s:'Temperature dips slightly just before ovulation',dur:'3 min', cl:'gr'},
        {e:'üíß',t:'Hydration Ritual',s:'Egg-white cervical mucus needs water ‚Äî drink 2L+',dur:'All day', cl:'gr'},
      ],
      mood:'‚¨ÜÔ∏è Energy & libido rising naturally',
      food:'Oestrogen support: fermented foods, flaxseeds ü•ó',
      avoid:'Avoid lubricants that harm sperm motility'
    },
    {
      tab:{e:'üéØ',l:'Peak'},
      badge:'üéØ Day 14 ¬± 2',
      hero:{e:'üéØ', t:'Ovulation Day ‚Äî Act Now', d:'Your LH has surged. The egg is released. This is your 12‚Äì24 hour peak window. Your body is at its most powerful.'},
      affKey:'PeakOvul',
      rituals:[
        {e:'üå°Ô∏è',t:'Confirm BBT Spike',s:'Temp rises 0.2‚Äì0.5¬∞C after ovulation ‚Äî log it!',dur:'2 min', cl:'gr'},
        {e:'üíä',t:'Check OPK Result',s:'Look for blazing positive LH strip today',dur:'2 min', cl:'gr'},
        {e:'üèÉ',t:'Light Walk After Intimacy',s:'Gentle movement ‚Äî no intense exercise today',dur:'15 min', cl:'gr'},
        {e:'ü´ê',t:'Antioxidant-Rich Smoothie',s:'Protect egg quality: berries, CoQ10, maca',dur:'5 min', cl:'gr'},
      ],
      mood:'‚ú® Peak confidence and libido today!',
      food:'Antioxidants for egg quality: berries, walnuts ü´ê',
      avoid:'Avoid hot tubs, excessive heat on the abdomen'
    },
    {
      tab:{e:'üìâ',l:'Post-Ovul'},
      badge:'üìâ Days 15‚Äì28',
      hero:{e:'üåô', t:'Luteal & Implantation Window', d:'Progesterone rises. If you\'re TTC, this is the implantation window (days 6‚Äì10 post-ovulation). Rest and nourish.'},
      affKey:'PostOvul',
      rituals:[
        {e:'üåø',t:'Seed Cycling ‚Äî Sesame & Sunflower',s:'Switch to Phase 2 seeds for progesterone support',dur:'Daily', cl:'gr'},
        {e:'üßò',t:'Restorative Yoga',s:'Support progesterone with gentle, calming movement',dur:'12 min', cl:'gr'},
        {e:'üå°Ô∏è',t:'Track BBT Stay Elevated',s:'If temp stays high 18+ days ‚Äî take a test!',dur:'Daily', cl:'gr'},
        {e:'ü´ñ',t:'Raspberry Leaf Tea',s:'Uterine toner to prepare for either outcome',dur:'5 min', cl:'gr'},
      ],
      mood:'üåä Progesterone dip = PMS ‚Äî be kind to yourself',
      food:'Progesterone support: vitamin B6, magnesium ü•ú',
      avoid:'Wait until day 28 before taking a pregnancy test'
    }
  ]
};

/* Which tab is selected in the care screen */
let currentCarePhase = {period:1, preg:1, ovul:1}; // default to phase index 1

function buildCare() {
  const isPrg = currentMode==='preg';
  const isOvl = currentMode==='ovul';
  const cl = isPrg ? 'bl' : isOvl ? 'gr' : '';
  const btnCl = isPrg ? ' bl' : isOvl ? ' gr' : '';

  const phases = CARE_DATA[currentMode];
  const activeIdx = currentCarePhase[currentMode];
  const p = phases[activeIdx];

  const habColor = isPrg ? '#4a70b0' : isOvl ? '#5a8e6a' : '#d97b8a';
  const habBorder = isPrg ? 'bl' : isOvl ? 'gr' : '';
  const aff = (ALL_AFFIRMATIONS[currentMode]||ALL_AFFIRMATIONS.period)[affIdx];

  /* ‚îÄ‚îÄ phase tabs ‚îÄ‚îÄ */
  let tabsHtml = `<div class="phase-strip" id="care-phase-strip">`;
  phases.forEach((ph, i) => {
    const isActive = i === activeIdx;
    tabsHtml += `<div class="phase-chip${isActive?' active-phase'+(cl?' '+cl:''):''}" onclick="selectCarePhase(${i})" style="cursor:pointer">
      <div class="phase-em">${ph.tab.e}</div>${ph.tab.l}
    </div>`;
  });
  tabsHtml += `</div>`;

  /* ‚îÄ‚îÄ dynamic section ‚îÄ‚îÄ */
  const dynHtml = buildCarePhaseSection(p, cl, btnCl);

  return `<div class="page-title">Self-Care üåø</div>
<div class="page-sub">${isPrg?'Nurture you & baby üíô':isOvl?'Fertility wellness rituals':'Your cycle wellness hub'}</div>
${tabsHtml}
<div id="care-phase-body" style="animation:pop 0.25s ease">${dynHtml}</div>

<div class="affirmation-card" onclick="cycleAffirmation(this)">
  <div class="aff-label">‚ú¶ Daily affirmation ‚Äî tap to refresh</div>
  <div class="aff-text" id="aff-text">"${aff}"</div>
  <div class="aff-tap">Tap for a new one üå∏</div>
</div>

<div class="breathe-card" onclick="openRitual()">
  <div class="breathe-orb">ü´Å</div>
  <div class="breathe-text">
    <div class="breathe-title">Guided Ritual Session</div>
    <div class="breathe-sub">Step-by-step with timers ‚Äî tap to start</div>
  </div>
  <button class="breathe-start">Begin ‚Üí</button>
</div>

<div class="section" style="margin-top:0">Today's habits</div>
<div class="habit-row">
  <div class="habit-card">
    <div class="habit-icon">üíß</div>
    <div class="habit-val" style="color:${habColor}">6</div>
    <div class="habit-lbl">Glasses</div>
  </div>
  <div class="habit-card ${habBorder}">
    <div class="habit-icon">üåô</div>
    <div class="habit-val" style="color:${habColor}">7h</div>
    <div class="habit-lbl">Sleep</div>
  </div>
  <div class="habit-card yl">
    <div class="habit-icon">üö∂</div>
    <div class="habit-val">4k</div>
    <div class="habit-lbl">Steps</div>
  </div>
  <div class="habit-card gr">
    <div class="habit-icon">ü•ó</div>
    <div class="habit-val">2/3</div>
    <div class="habit-lbl">Meals</div>
  </div>
</div>
<div style="text-align:center;font-size:0.7rem;color:#d0b0b8;font-weight:700;padding:14px 0;border-top:1px solid #fce8e4;margin-top:4px">üíï Self-care is not selfish ‚Äî it's essential</div>`;
}

function buildCarePhaseSection(p, cl, btnCl) {
  let ritHtml = '';
  p.rituals.forEach(r => {
    ritHtml += `<div class="ritual-card${r.cl?' '+r.cl:''}">
  <div class="ritual-icon">${r.e}</div>
  <div class="ritual-info">
    <div class="ritual-title">${r.t}</div>
    <div class="ritual-sub">${r.s}</div>
  </div>
  <div class="ritual-dur">${r.dur}</div>
</div>`;
  });

  return `<div class="care-hero">
  <div class="care-hero-badge${cl?' '+cl:''}">${p.badge}</div>
  <div class="care-hero-emoji">${p.hero.e}</div>
  <div class="care-hero-title">${p.hero.t}</div>
  <div class="care-hero-desc">${p.hero.d}</div>
  <button class="care-action-btn${btnCl}" onclick="openRitual()">Start Today's Ritual ‚ú¶</button>
</div>
<div class="care-tip-strip">
  <div class="ctp mood"><span class="ctp-ico">üí≠</span><span class="ctp-txt">${p.mood}</span></div>
  <div class="ctp food"><span class="ctp-ico">üçΩÔ∏è</span><span class="ctp-txt">${p.food}</span></div>
  <div class="ctp avoid"><span class="ctp-ico">‚ö†Ô∏è</span><span class="ctp-txt">${p.avoid}</span></div>
</div>
<div class="section" style="margin-top:4px">Phase rituals for you</div>
${ritHtml}`;
}

function selectCarePhase(idx) {
  currentCarePhase[currentMode] = idx;
  const isPrg = currentMode==='preg';
  const isOvl = currentMode==='ovul';
  const cl = isPrg ? 'bl' : isOvl ? 'gr' : '';
  const btnCl = isPrg ? ' bl' : isOvl ? ' gr' : '';
  const phases = CARE_DATA[currentMode];

  /* update tab highlights */
  const strip = document.getElementById('care-phase-strip');
  if(strip) {
    strip.querySelectorAll('.phase-chip').forEach((chip, i) => {
      chip.className = 'phase-chip' + (i===idx ? ' active-phase'+(cl?' '+cl:'') : '');
      chip.style.cursor = 'pointer';
    });
  }

  /* swap dynamic section with animation */
  const body = document.getElementById('care-phase-body');
  if(body) {
    body.style.opacity='0'; body.style.transform='translateY(6px)';
    body.style.transition='opacity 0.18s ease, transform 0.18s ease';
    setTimeout(() => {
      body.innerHTML = buildCarePhaseSection(phases[idx], cl, btnCl);
      body.style.opacity='1'; body.style.transform='translateY(0)';
    }, 180);
  }
}

const ALL_AFFIRMATIONS = {
  period:['My body is wise and worthy of rest.','I release what no longer serves me.','I honour every phase of my cycle.','I give myself permission to slow down.','My sensitivity is my strength.','I am exactly where I need to be.'],
  preg:['My body knows exactly how to nurture this life.','I trust the journey, one week at a time.','Every kick is a little love letter.','I am strong, capable, and surrounded by love.','Growing a human is the most magical thing.','I breathe in calm and breathe out fear.'],
  ovul:['My body is fertile ground for new beginnings.','I work with my cycle, not against it.','I am in tune with my natural rhythm.','My body communicates ‚Äî I am learning to listen.','I honour the wisdom of my hormones.','Every cycle is a fresh start.']
};
let affIdx = 0;
function cycleAffirmation(card) {
  const pool = ALL_AFFIRMATIONS[currentMode] || ALL_AFFIRMATIONS.period;
  affIdx = (affIdx + 1) % pool.length;
  const el = document.getElementById('aff-text');
  if(el) { el.style.opacity='0'; setTimeout(()=>{ el.textContent='"'+pool[affIdx]+'"'; el.style.opacity='1'; }, 200); }
  el && (el.style.transition='opacity 0.2s');
  card.style.transform='scale(0.98)'; setTimeout(()=>card.style.transform='',150);
}
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RITUAL SESSION ENGINE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let ritualState = {
  rituals: [],       // array of ritual objects for current session
  idx: 0,            // current ritual index
  timerSec: 0,       // countdown seconds
  timerInterval: null,
  timerRunning: false,
  timerTotal: 0,
  completed: [],     // which indices are done
  cl: '',            // colour class
  btnCl: ''
};

/* Parse a duration string like "8 min", "15 min", "All day" into seconds */
function durToSec(durStr) {
  const m = durStr.match(/(\d+)\s*min/i);
  if(m) return parseInt(m[1]) * 60;
  const s = durStr.match(/(\d+)\s*s/i);
  if(s) return parseInt(s[1]);
  return 0; // "All day", "Daily" etc ‚Üí no timer
}

function fmtTime(sec) {
  if(sec <= 0) return '‚úì';
  const m = Math.floor(sec/60), s = sec%60;
  return m>0 ? `${m}:${s.toString().padStart(2,'0')}` : `${s}s`;
}

function openRitual() {
  const mode = currentMode;
  const phase = CARE_DATA[mode][currentCarePhase[mode]];
  const isPrg = mode==='preg', isOvl = mode==='ovul';
  const cl = isPrg?'bl':isOvl?'gr':'';
  const btnCl = isPrg?' bl':isOvl?' gr':'';

  ritualState = {
    rituals: phase.rituals,
    idx: 0,
    timerSec: 0,
    timerInterval: null,
    timerRunning: false,
    timerTotal: 0,
    completed: [],
    cl, btnCl
  };

  // Style overlay
  const ov = document.getElementById('ritual-overlay');
  ov.className = 'ritual-overlay' + (cl ? ' '+cl : '');

  // Style header elements
  document.getElementById('ro-close-btn').className = 'ro-close' + (cl ? ' '+cl : '');
  document.getElementById('ro-prog-bg').className = 'ro-progress-bar-bg' + (cl ? ' '+cl : '');
  document.getElementById('ro-prog-bar').className = 'ro-progress-bar' + (cl ? ' '+cl : '');
  document.getElementById('ro-next-btn').className = 'ro-btn-next' + btnCl;

  renderRitualStep();

  // Slide up
  requestAnimationFrame(() => {
    ov.style.display = 'flex';
    requestAnimationFrame(() => ov.classList.add('open'));
  });
}

function closeRitual() {
  clearInterval(ritualState.timerInterval);
  ritualState.timerRunning = false;
  const ov = document.getElementById('ritual-overlay');
  ov.classList.remove('open');
  setTimeout(() => ov.style.display = 'none', 420);
}

function renderRitualStep() {
  const {rituals, idx, cl, btnCl, completed} = ritualState;
  const r = rituals[idx];
  const total = rituals.length;
  const pct = Math.round(((idx+1)/total)*100);
  const sec = durToSec(r.dur);
  const hasTimer = sec > 0;

  ritualState.timerSec = sec;
  ritualState.timerTotal = sec;
  ritualState.timerRunning = false;
  clearInterval(ritualState.timerInterval);

  // Update header
  document.getElementById('ro-title').textContent = 'Today\'s Ritual';
  document.getElementById('ro-step-lbl').textContent = `${idx+1} of ${total}`;
  document.getElementById('ro-prog-bar').style.width = pct+'%';

  // Build body
  const circumference = 2 * Math.PI * 52; // r=52
  const arcLen = circumference;

  let tipHtml = '';
  if(!hasTimer) {
    tipHtml = `<div class="ro-tip">üí° This is an ongoing ritual ‚Äî just set your intention and carry it through your day.</div>`;
  }

  // Checklist of all rituals
  let checkHtml = '<div class="ro-checklist">';
  rituals.forEach((ri, i) => {
    const isDone = completed.includes(i);
    const doneCls = isDone ? ' done' + (cl==='bl' ? ' bl-done' : '') : '';
    const tick = isDone ? '‚úì' : '';
    checkHtml += `<div class="ro-check-item${doneCls}">
      <div class="ro-check-box">${tick}</div>
      <span>${ri.e} ${ri.t}</span>
    </div>`;
  });
  checkHtml += '</div>';

  document.getElementById('ro-body').innerHTML = `
    <div class="ro-ritual-icon" id="ro-icon">${r.e}</div>
    <div class="ro-ritual-name">${r.t}</div>
    <div class="ro-ritual-desc${cl?' '+cl:''}">${r.s}</div>
    ${hasTimer ? `
    <div class="ro-timer-wrap" id="ro-timer-wrap">
      <svg class="ro-timer-svg" width="130" height="130" viewBox="0 0 130 130">
        <circle class="ro-timer-bg${cl?' '+cl:''}" cx="65" cy="65" r="52"/>
        <circle class="ro-timer-arc${cl?' '+cl:''}" id="ro-arc" cx="65" cy="65" r="52"
          stroke-dasharray="${arcLen}"
          stroke-dashoffset="0"/>
      </svg>
      <div class="ro-timer-center">
        <div class="ro-timer-time" id="ro-time">${fmtTime(sec)}</div>
        <div class="ro-timer-unit">${r.dur}</div>
      </div>
    </div>` : `<div style="font-size:3rem;margin-bottom:20px">${r.e}</div>`}
    ${tipHtml}
    ${checkHtml}
  `;

  // Next button label
  const isLast = idx === total - 1;
  const nextBtn = document.getElementById('ro-next-btn');
  if(hasTimer) {
    nextBtn.textContent = 'Start timer ‚ñ∂';
  } else {
    nextBtn.textContent = isLast ? 'Finish session üå∏' : 'Mark done & next ‚Üí';
  }
}

function ritualNext() {
  const {rituals, idx, cl, btnCl, timerRunning, timerSec, timerTotal, completed} = ritualState;
  const r = rituals[idx];
  const total = rituals.length;
  const sec = durToSec(r.dur);
  const hasTimer = sec > 0;
  const isLast = idx === total - 1;

  if(hasTimer && !ritualState.timerRunning) {
    // Start the timer
    ritualState.timerRunning = true;
    const arcEl = document.getElementById('ro-arc');
    const timeEl = document.getElementById('ro-time');
    const circumference = 2 * Math.PI * 52;
    const nextBtn = document.getElementById('ro-next-btn');
    nextBtn.textContent = 'Done early ‚Üí';

    ritualState.timerInterval = setInterval(() => {
      ritualState.timerSec--;
      if(timeEl) timeEl.textContent = fmtTime(ritualState.timerSec);
      if(arcEl) {
        const progress = ritualState.timerSec / ritualState.timerTotal;
        arcEl.style.strokeDashoffset = circumference * (1 - progress);
      }
      if(ritualState.timerSec <= 0) {
        clearInterval(ritualState.timerInterval);
        ritualState.timerRunning = false;
        if(timeEl) timeEl.textContent = '‚úì';
        advanceRitual();
      }
    }, 1000);
    return;
  }

  // No timer or timer already running (skip/done early) ‚Üí advance
  advanceRitual();
}

function ritualSkip() {
  clearInterval(ritualState.timerInterval);
  ritualState.timerRunning = false;
  advanceRitual(true);
}

function advanceRitual(skipped) {
  const {rituals, idx, completed} = ritualState;
  const total = rituals.length;

  if(!skipped && !completed.includes(idx)) {
    ritualState.completed.push(idx);
  }

  if(idx >= total - 1) {
    showRitualComplete();
  } else {
    ritualState.idx++;
    // Brief pop animation
    const body = document.getElementById('ro-body');
    if(body) {
      body.style.opacity='0'; body.style.transform='translateX(20px)';
      body.style.transition='opacity 0.2s,transform 0.2s';
      setTimeout(() => {
        body.style.opacity=''; body.style.transform=''; body.style.transition='';
        renderRitualStep();
      }, 200);
    }
  }
}

function showRitualComplete() {
  const {rituals, completed, cl, btnCl} = ritualState;
  const total = rituals.length;
  const done = completed.length;
  const prog = Math.round((done/total)*100);

  document.getElementById('ro-step-lbl').textContent = 'Complete!';
  document.getElementById('ro-prog-bar').style.width = '100%';
  document.getElementById('ro-footer').innerHTML = `
    <button class="ro-btn-next${btnCl}" style="flex:1" onclick="closeRitual()">Back to Self-Care üåø</button>
  `;

  const msgs = {
    period: 'Your body thanks you for this love. üå∏',
    preg:   'You and baby are both glowing üíô',
    ovul:   'Your hormones are supported. üåø'
  };

  document.getElementById('ro-body').innerHTML = `
    <div class="ro-complete">
      <div class="ro-complete-em">${done===total?'üåü':'‚ú®'}</div>
      <div class="ro-complete-title">${done===total?'Ritual Complete!':'Session Done!'}</div>
      <div class="ro-complete-sub">${msgs[currentMode]||'Great work today.'}<br>You showed up for yourself ‚Äî that matters.</div>
      <div class="ro-streak">
        <div class="ro-streak-val">${done}/${total}</div>
        <div class="ro-streak-lbl">rituals completed today</div>
      </div>
      <div style="width:100%;background:#fce8e4;border-radius:8px;overflow:hidden;height:8px;margin-bottom:6px">
        <div style="width:${prog}%;height:100%;background:linear-gradient(90deg,#f09090,#d97b8a);border-radius:8px;transition:width 0.6s ease"></div>
      </div>
      <div style="font-size:0.68rem;font-weight:800;color:#d0b0b8">${prog}% of today's ritual</div>
    </div>
  `;
}

function startBreather() {
  // Now routes to the ritual session instead of the old inline breathe hack
  openRitual();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HELPERS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function sel(el, selector) {
  const scope = el.closest('#log-content') || el.closest('.screen') || document;
  scope.querySelectorAll(selector).forEach(b => b.classList.remove('on','on-bl','on-gr'));
  el.classList.add('on');
}
function selChipSingle(el, selector) {
  const scope = el.closest('#log-content') || document;
  scope.querySelectorAll(selector).forEach(b => b.classList.remove('on','on-bl','on-gr'));
  el.classList.add('on-gr');
}
function selLang(el) { document.querySelectorAll('.lang-btn').forEach(b=>b.classList.remove('on')); el.classList.add('on'); }
function selCat(el, cls) {
  document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('on','on-bl','on-gr'));
  el.classList.add(cls||'on');
}
function adj(btn, d, mn, mx) {
  const v = btn.parentElement.querySelector('.ls-val');
  if(v) v.textContent = Math.min(mx, Math.max(mn, parseInt(v.textContent)+d));
}
function doKick() {
  kicks++;
  const el = document.getElementById('kick-num');
  if(el) { el.textContent = kicks; el.style.transform='scale(1.4)'; setTimeout(()=>el.style.transform='scale(1)',160); }
}
</script>
</body>
</html>
